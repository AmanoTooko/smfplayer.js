(function(){/*
 @logue/smfplayer v0.2.2 | imaya / GREE Inc. / Logue | license: MIT */
'use strict';(function(v,f){"object"===typeof exports&&"object"===typeof module?module.exports=f():"function"===typeof define&&define.amd?define("SMF",[],f):"object"===typeof exports?exports.SMF=f():v.SMF=f()})("undefined"!==typeof self?self:this,function(){return function(v){function f(k){if(t[k])return t[k].exports;var b=t[k]={i:k,l:!1,exports:{}};v[k].call(b.exports,b,b.exports,f);b.l=!0;return b.exports}var t={};f.m=v;f.c=t;f.d=function(k,b,a){f.o(k,b)||Object.defineProperty(k,b,{enumerable:!0,
get:a})};f.r=function(k){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(k,Symbol.toStringTag,{value:"Module"});Object.defineProperty(k,"__esModule",{value:!0})};f.t=function(k,b){b&1&&(k=f(k));if(b&8||b&4&&"object"===typeof k&&k&&k.__esModule)return k;var a=Object.create(null);f.r(a);Object.defineProperty(a,"default",{enumerable:!0,value:k});if(b&2&&"string"!=typeof k)for(var c in k)f.d(a,c,function(c){return k[c]}.bind(null,c));return a};f.n=function(k){var b=k&&k.__esModule?
function(){return k["default"]}:function(){return k};f.d(b,"a",b);return b};f.o=function(k,b){return Object.prototype.hasOwnProperty.call(k,b)};f.p="";return f(f.s=4)}([function(v,f,t){t.d(f,"a",function(){return b});t.d(f,"c",function(){return a});t.d(f,"b",function(){return c});class k{constructor(c,a,b){this.subtype=c;this.deltaTime=a;this.time=b}}class b extends k{constructor(c,a,b,g,r,n){super(c,a,b);this.channel=g;this.parameter1=r;this.parameter2=n}}class a extends k{constructor(c,a,b,g){super(c,
a,b);this.data=g}}class c extends k{constructor(c,a,b,g){super(c,a,b);this.data=g}}},function(v,f,t){t.d(f,"a",function(){return k});class k{constructor(a,c={}){this.input=a;this.ip=c.index||0;this.length=c.length||a.length-this.ip;this.offset=this.ip;this.padding=void 0!==c.padding?c.padding:!0;this.bigEndian=void 0!==c.bigEndian?c.bigEndian:!1}parse(){const a=this.length+this.offset;for(this.chunkList=[];this.ip<a;)this.parseChunk()}parseChunk(){var a=this.input;let c=this.ip;this.chunkList.push(new b(String.fromCharCode(a[c++],
a[c++],a[c++],a[c++]),a=this.bigEndian?(a[c++]<<24|a[c++]<<16|a[c++]<<8|a[c++])>>>0:(a[c++]|a[c++]<<8|a[c++]<<16|a[c++]<<24)>>>0,c));c+=a;this.padding&&1===(c-this.offset&1)&&c++;this.ip=c}getChunk(a){a=this.chunkList[a];return void 0===a?null:a}getNumberOfChunks(){return this.chunkList.length}}class b{constructor(a,c,b){this.type=a;this.size=c;this.offset=b}}},function(v,f,t){t.r(f);t.d(f,"default",function(){return a});var k=t(1),b=t(0);class a{constructor(c,a={}){a.padding=!1;a.bigEndian=!0;this.input=
c;this.ip=a.index||0;this.chunkIndex=0;this.riffParser_=new k.a(c,a);this.timeDivision=this.numberOfTracks=this.formatType=0;this.tracks=[];this.plainTracks=[]}parse(){let c,a;this.riffParser_.parse();this.parseHeaderChunk();c=0;for(a=this.numberOfTracks;c<a;++c)this.parseTrackChunk()}parseHeaderChunk(){const c=this.riffParser_.getChunk(this.chunkIndex++),a=this.input;let b=c.offset;if(!c||"MThd"!==c.type)throw Error("invalid header signature");this.formatType=a[b++]<<8|a[b++];this.numberOfTracks=
a[b++]<<8|a[b++];this.timeDivision=a[b++]<<8|a[b++]}parseTrackChunk(){var c=this.riffParser_.getChunk(this.chunkIndex++);const a=this.input;let d=c.offset,q=0;var g=0;let r=0;var n=0;let k=-1,p=-1,l=n=0;var h=0;let m=g=0,u;const f=()=>{let c=0,b;do b=a[d++],c=c<<7|b&127;while(0!==(b&128));return c};if(!c||"MTrk"!==c.type)throw Error("invalid header signature");q=c.offset+c.size;c=[];const t=[];for(;d<q;){g=f();l+=g;h=d;m=a[d++];r=m>>4&15;n=m&15;8>r?(r=k,n=p,m=k<<4|p,d--,h--):(k=r,p=n);const e=[,,
,,,,,,"NoteOff","NoteOn","NoteAftertouch","ControlChange","ProgramChange","ChannelAftertouch","PitchBend"];switch(r){case 8:case 9:case 10:case 11:case 13:case 14:u=new b.a(e[r],g,l,n,a[d++],a[d++]);break;case 12:u=new b.a(e[r],g,l,n,a[d++]);break;case 15:switch(n){case 0:n=f();if(247!==a[d+n-1])throw Error("invalid SysEx event");u=new b.c("SystemExclusive",g,l,a.subarray(d,(d+=n)-1));break;case 7:n=f();u=new b.c("SystemExclusive(F7)",g,l,a.subarray(d,d+=n));break;case 15:r=a[d++];n=f();switch(r){case 0:u=
new b.b("SequenceNumber",g,l,[a[d++],a[d++]]);break;case 1:u=new b.b("TextEvent",g,l,[String.fromCharCode.apply(null,a.subarray(d,d+=n))]);break;case 2:u=new b.b("CopyrightNotice",g,l,[String.fromCharCode.apply(null,a.subarray(d,d+=n))]);break;case 3:u=new b.b("SequenceTrackName",g,l,[String.fromCharCode.apply(null,a.subarray(d,d+=n))]);break;case 4:u=new b.b("InstrumentName",g,l,[String.fromCharCode.apply(null,a.subarray(d,d+=n))]);break;case 5:u=new b.b("Lyrics",g,l,[String.fromCharCode.apply(null,
a.subarray(d,d+=n))]);break;case 6:u=new b.b("Marker",g,l,[String.fromCharCode.apply(null,a.subarray(d,d+=n))]);break;case 7:u=new b.b("CuePoint",g,l,[String.fromCharCode.apply(null,a.subarray(d,d+=n))]);break;case 32:u=new b.b("MidiChannelPrefix",g,l,[a[d++]]);break;case 47:u=new b.b("EndOfTrack",g,l,[]);break;case 81:u=new b.b("SetTempo",g,l,[a[d++]<<16|a[d++]<<8|a[d++]]);break;case 84:u=new b.b("SmpteOffset",g,l,[a[d++],a[d++],a[d++],a[d++],a[d++]]);break;case 88:u=new b.b("TimeSignature",g,l,
[a[d++],a[d++],a[d++],a[d++]]);break;case 89:u=new b.b("KeySignature",g,l,[a[d++],a[d++]]);break;case 127:u=new b.b("SequencerSpecific",g,l,[a.subarray(d,d+=n)]);break;default:u=new b.b("Unknown",g,l,[r,a.subarray(d,d+=n)])}break;default:console.log("unknown message:",m.toString(16))}break;default:throw Error("invalid status");}g=d-h;h=a.subarray(h,h+g);h[0]=m;u instanceof b.a&&"NoteOn"===u.subtype&&0===u.parameter2&&(u.subtype=e[8],h=new Uint8Array([128|u.channel,u.parameter1,u.parameter2]));t.push(h);
c.push(u)}this.tracks.push(c);this.plainTracks.push(t)}}},function(v,f,t){t.d(f,"a",function(){return k});class k{constructor(b,a={}){this.input=b;this.ip=a.index||0}parse(){this.parseHeader();this.parseDataInformation();this.parseTracks()}parseHeader(){const b=this.input;let a=this.ip;const c=this.header={},e=String.fromCharCode(b[a++],b[a++],b[a++],b[a++]);if("melo"!==e)throw Error("invalid MFi signature:"+e);c.fileLength=(b[a++]<<24|b[a++]<<16|b[a++]<<8|b[a++])>>>0;c.trackOffset=(b[a++]<<16|b[a++])+
a;c.dataMajorType=b[a++];c.dataMinorType=b[a++];c.numberOfTracks=b[a++];this.ip=a}parseDataInformation(){const b=this.input;let a=this.ip;const c=this.dataInformation={copy:null,date:null,exst:null,note:null,prot:null,sorc:null,titl:null,trac:null,vers:null};let e,d;for(;a<this.header.trackOffset;)switch(e=String.fromCharCode(b[a++],b[a++],b[a++],b[a++]),d=b[a++]<<8|b[a++],e){case "titl":case "copy":case "vers":case "date":case "prot":c[e]=String.fromCharCode.apply(null,b.subarray(a,a+=d));break;
case "sorc":c[e]=b[a++];break;case "note":c[e]=b[a++]<<8|b[a++];break;case "exst":break;default:c[e]=b.subarray(a,a+=d)}this.ip=a}parseTracks(){const b=this.input;let a=this.ip;let c;const e=this.tracks=[];let d,q,g;const r=()=>{var c=b[a++]<<8|b[a++];c=a+c;const e=[];let d;if(1!==b[a++])throw Error("invalid EditInstrument const value:"+b[a-1]);for(;a<c;)d={},d.part=b[a++]>>4&3,d.modulator={ML:b[a]>>5,VIV:b[a]>>4&1,EG:b[a]>>3&1,SUS:b[a]>>2&1,RR:(b[a++]&3)<<2|b[a]>>6,DR:b[a]>>4&15,AR:(b[a++]&3)<<2|
b[a]>>6,SL:b[a]>>4&15,TL:(b[a++]&3)<<4|b[a]>>4,WF:b[a]>>3&1,FB:b[a++]&7},d.carrier={ML:b[a]>>5,VIV:b[a]>>4&1,EG:b[a]>>3&1,SUS:b[a]>>2&1,RR:(b[a++]&3)<<2|b[a]>>6,DR:b[a]>>4&15,AR:(b[a++]&3)<<2|b[a]>>6,SL:b[a]>>4&15,TL:(b[a++]&3)<<4|b[a]>>4,WF:b[a]>>3&1,FB:b[a++]&7},d.octaveSelect=b[a++]&3,e.push(d);return e},n=()=>{var c=b[a++]<<8|b[a++];c=a+c;if(17!==b[a++])throw Error("invalid DeviceSpecific const value:"+b[a-1]);return{data:b.subarray(a,a+=c-a)}};q=0;for(g=this.header.numberOfTracks;q<g;++q){var k=
String.fromCharCode(b[a++],b[a++],b[a++],b[a++]);if("trac"!==k)throw Error("invalid track signature:"+k);k=b[a++]<<24|b[a++]<<16|b[a++]<<8|b[a++];k=a+k;for(d=e[q]=[];a<k;){c={key:null,length:null,octaveShift:null,subType:null,type:null,value:{},velocity:null,voice:null};c.deltaTime=deltaTime=b[a++];var p=b[a++];if(255!==p)c.type="note",c.subType="Note",c.voice=p>>6,c.key=p&63,noteLength=c.length=b[a++],1===this.dataInformation.note&&(p=b[a++],c.velocity=p>>2,c.octaveShift=p&3);else switch(c.type=
"meta",p=b[a++],p>>4){case 11:switch(p&15){case 0:c.subType="MasterVolume";c.value=b[a++];break;case 10:c.subType="DrumScale";c.value={channel:b[a]>>3&7,drum:b[a++]&1};break;default:throw Error("unknown message type:"+p.toString(16));}break;case 12:c.subType="SetTempo";c.value={timeBase:7===(p&7)?NaN:Math.pow(2,p&7)*(0===(p&8)?6:15),tempo:b[a++]};break;case 13:switch(p&15){case 0:c.subType="Point";c.value=b[a++];break;case 13:c.subType="Loop";c.value={id:b[a]>>6,count:b[a]>>2&15,point:b[a++]&3};break;
case 14:c.subType="Nop";c.value=b[a++];break;case 15:c.subType="EndOfTrack";c.value=b[a++];break;default:throw Error("unkwnon message type:"+p.toString(16));}break;case 14:switch(p&15){case 0:c.subType="InstrumentLowPart";c.value={part:b[a]>>6,instrument:b[a++]&63};break;case 1:c.subType="InstrumentHighPart";c.value={part:b[a]>>6,instrument:b[a++]&1};break;case 2:c.subType="Volume";c.value={part:b[a]>>6,volume:b[a++]&63};break;case 3:c.subType="Valance";c.value={part:b[a]>>6,valance:b[a++]&63};break;
case 4:c.subType="PitchBend";c.value={part:b[a]>>6,value:b[a++]&63};break;case 5:c.subType="ChannelAssign";c.value={part:b[a]>>6,channel:b[a++]&63};break;case 6:c.subType="VolumeChange";c.value={part:b[a]>>6,volume:(b[a++]&63)<<26>>26};break;case 7:c.subType="PitchBendRange";c.value={part:b[a]>>6,value:b[a++]&63};break;case 8:case 9:c.subType="MasterCoarseTuning";c.value={part:b[a]>>6,value:b[a++]&63};break;case 10:c.subType="Modulation";c.value={part:b[a]>>6,depth:b[a++]&63};break;default:throw Error("unkwnon message type:"+
p.toString(16));}break;case 15:switch(p&15){case 0:c.subType="EditInstrument";c.value=r();break;case 1:c.subType="Vibrato";p=c;if(1!==b[a++])throw Error("invalid Vibrato const value:"+b[a-1]);var l={part:b[a++]>>5&3,"switch":b[a++]>>6};p.value=l;break;case 15:c.subType="DeviceSpecific";c.value=n();break;default:throw Error("unkwnon message type:"+p.toString(16));}break;default:throw Error("unkwnon message type:"+p.toString(16));}d.push(c)}a=k}this.ip=a}convertToMidiTracks(){var b={timeDivision:48,
trac:[],plainTracks:[]};const a=b.tracks;b=b.plainTracks;const c=this.tracks;let e;let d,q,g,r,k,f,p;const l=[];for(r=0;16>r;++r)b[r]=[],l[r]=0;r=0;for(k=c.length;r<k;++r){var h=c[r];d=[];q=g=f=0;for(p=h.length;f<p;++f)switch(e=h[f],q+=e.deltaTime,e.id=g,e.time=q,e.subType){case "Nop":break;case "Note":d[g++]=e;d[g]={id:g,type:"internal",subType:"NoteOff",time:q+e.length,key:e.key,voice:e.voice,velocity:e.velocity,octaveShift:e.octaveShift};g++;break;case "InstrumentHighPart":var m=e;e=h[++f];if("InstrumentLowPart"!==
e.subType)throw Error("broken instrument");d[g]={id:g,type:"internal",subType:"ProgramChange",time:q,part:e.value.part,instrument:m.value.instrument<<6|e.value.instrument};g++;break;default:d[g++]=e}d.sort((a,c)=>a.time>c.time?1:a.time<c.time?-1:a.id>c.id?1:a.id<c.id?-1:0);a[r]=[];q=f=0;for(p=d.length;f<p;++f){e=d[f];q=e.time;switch(e.subType){case "Note":m=this.applyOctaveShift(e.key+45,e.octaveShift);h=4*r+e.voice;9===h&&(m-=10);b[h].push(this.deltaTimeToByteArray(q-l[h]).concat(144|h,m,2*e.velocity));
break;case "NoteOff":m=this.applyOctaveShift(e.key+45,e.octaveShift);h=4*r+e.voice;9===h&&(m-=10);b[h].push(this.deltaTimeToByteArray(q-l[h]).concat(128|h,m,2*e.velocity));break;case "ProgramChange":h=4*r+e.part;b[h].push(this.deltaTimeToByteArray(q-l[h]).concat(192|h,e.instrument));break;case "SetTempo":m=288E7/(e.value.tempo*e.value.timeBase);h=0;b[h].push(this.deltaTimeToByteArray(q-l[h]).concat(255,81,3,m>>16&255,m>>8&255,m&255));break;case "Loop":m=e.value.count;m="LOOP_"+(0===e.value.point?
"START":"END")+"=ID:"+e.value.id+",COUNT:"+(0===m?-1:m);h=0;b[h].push(this.deltaTimeToByteArray(q-l[h]).concat([255,6,m.length],m.split("").map(a=>a.charCodeAt(0))));break;case "MasterVolume":m=e.value;h=0;b[h].push(this.deltaTimeToByteArray(q-l[h]).concat(240,7,127,127,4,1,m,m,247));break;case "Modulation":h=4*r+e.value.part;b[h].push(this.deltaTimeToByteArray(q-l[h]).concat(176|h,1,2*e.value.depth));break;case "Volume":h=4*r+e.value.part;b[h].push(this.deltaTimeToByteArray(q-l[h]).concat(176|h,
7,2*e.value.volume));break;case "Valance":h=4*r+e.value.part;b[h].push(this.deltaTimeToByteArray(q-l[h]).concat(176|h,10,2*(e.value.valance-32)+64));break;case "PitchBend":h=4*r+e.value.part;b[h].push(this.deltaTimeToByteArray(q-l[h]).concat(224|h,2*e.value.value,2*e.value.value));break;case "PitchBendRange":h=4*r+e.value.part;b[h].push(this.deltaTimeToByteArray(q-l[h]).concat(176|h,100,0),[0,176|h,101,0],[0,176|h,6,2*e.value.value]);break;case "MasterCoarseTuning":h=4*r+e.value.part;b[h].push(this.deltaTimeToByteArray(q-
l[h]).concat(176|h,100,0),[0,176|h,101,2],[0,176|h,6,2*e.value.value]);break;default:continue}l[h]=e.time}}return this.toSMF(b)}applyOctaveShift(b,a){const c=[0,12,-24,-12];if(void 0!==c[a])return b+c[a];throw Error("invalid OctaveShift value:"+a);}toSMF(b){var a;let c=[77,84,104,100,0,0,0,6,0,1,0,16,0,48];let e;if(void 0!==this.dataInformation.copy){var d=this.dataInformation.copy;var q=d.length;var g=Array(q);for(a=0;a<q;++a)g[a]=d.charCodeAt(a);a=d=g;d=a.length;a=[0,255,2].concat(this.deltaTimeToByteArray(d),
a);b[0].unshift(a)}q=0;for(d=b.length;q<d;++q){const d=b[q];a=[];g=0;for(e=d.length;g<e;++g)Array.prototype.push.apply(a,d[g]);e=a.length;g=[77,84,114,107,e>>24&255,e>>16&255,e>>8&255,e&255];c=c.concat(g,a)}return new Uint8Array(c)}deltaTimeToByteArray(b){const a=[];for(;128<=b;)a.unshift(b&127|(0===a.length?0:128)),b>>>=7;a.unshift(b|(0===a.length?0:128));return a}}},function(v,f,t){t.r(f);t.d(f,"Player",function(){return a});var k=t(2),b=t(3);class a{constructor(a="#wml"){this.tempo=5E5;this.pause=
!0;this.ready=!1;this.position=0;this.track=[];this.timer=0;this.sequence={};this.enableLoop=this.enableMFiLoop=this.enableFalcomLoop=this.enableCC111Loop=!1;this.tempoRate=1;this.masterVolume=16383;this.sequenceName="";this.copyright=[];this.webMidiLink=null;this.loaded=this.time=this.length=0;this.window=window;this.target=this.window.document.querySelector(a)}setCC111Loop(a){this.enableCC111Loop=a}setFalcomLoop(a){this.enableFalcomLoop=a}setMFiLoop(a){this.enableMFiLoop=a}setLoop(a){this.enableLoop=
a}stop(){let a;this.pause=!0;this.resume=Date.now();if(this.webMidiLink)for(a=0;16>a;++a)this.webMidiLink.contentWindow.postMessage("midi,b"+a.toString(16)+",78,0","*")}getWebMidiLink(){return this.webMidiLink}init(){this.stop();this.initSequence();this.pause=!0;this.track=null;this.resume=-1;this.copyright=this.sequenceName=this.sequence=null;this.timeTotal=this.time=this.position=this.length=0;this.window.clearTimeout(this.timer);const a=this;this.ready?this.sendInitMessage():this.window.addEventListener("message",
c=>{"link,ready"===c.data&&a.sendInitMessage()},!1)}initSequence(){this.tempo=5E5;this.position=0;this.sendInitMessage();this.pause=!1}play(){const a=this;if(!this.webMidiLink)throw Error("WebMidiLink not found");this.ready?this.track?(this.length=this.track.length,this.track instanceof Array&&this.position>=this.length&&(this.position=0),this.playSequence()):console.warn("Midi file is not loaded."):this.window.addEventListener("message",c=>{"link,ready"===c.data&&(a.ready=!0,a.webMidiLink.style.height=
this.webMidiLink.contentWindow.document.body.scrollHeight+"px",a.playSequence())},!1)}ended(){player.window.postMessage("endoftrack","*")}sendInitMessage(){const a=this.webMidiLink.contentWindow;let b;for(b=0;16>b;++b)a.postMessage("midi,b"+b.toString(16)+",128,0","*"),a.postMessage("midi,b"+b.toString(16)+",07,64","*"),a.postMessage("midi,b"+b.toString(16)+",0a,40","*"),a.postMessage("midi,e"+b.toString(16)+",00,40","*"),a.postMessage("midi,b"+b.toString(16)+",64,00","*"),a.postMessage("midi,b"+
b.toString(16)+",65,00","*"),a.postMessage("midi,b"+b.toString(16)+",06,02","*"),a.postMessage("midi,b"+b.toString(16)+",26,00","*");this.sendGmReset()}setWebMidiLink(a="./wml.html"){const b=this,c=a=>{"string"===typeof a.data&&(a=a.data.split(","),"link"===a[0]&&("ready"===a[1]?(b.ready=!0,b.loaded=100,b.setMasterVolume(b.masterVolume)):"progress"===a[1]&&(b.loaded=Math.round(a[2]/a[3]*1E4))))};if("string"===typeof a){this.webMidiLink&&this.webMidiLink.parentNode.removeChild(this.webMidiLink);this.target.firstChild&&
this.target.removeChild(this.target.firstChild);const b=this.webMidiLink=this.window.document.createElement("iframe");b.src=a;b.className="wml";this.target.appendChild(b);this.window.addEventListener("message",c,!1);const d=()=>{b.style.height=this.webMidiLink.contentWindow.document.body.scrollHeight+"px"};this.window.addEventListener("load",d,!1);let e=0;this.window.addEventListener("resize",()=>{0<e&&clearTimeout(e);e=setTimeout(d,100)},!1)}else this.webMidiLink.addEventListener("message",c,!1)}setMasterVolume(a){this.masterVolume=
a;this.webMidiLink&&this.webMidiLink.contentWindow.postMessage("midi,f0,7f,7f,04,01,"+[("0"+(a&127).toString(16)).substr(-2),("0"+(a>>7&127).toString(16)).substr(-2),"7f"].join(),"*")}setTempoRate(a){this.tempoRate=a}playSequence(){const a=this,b=this.sequence.timeDivision,d=this.track,k=this.webMidiLink.contentWindow;let g=this.position||0;const f=[],n=()=>{const c=d[g].time,e=d.length;let l,h=Date.now();if(a.pause)a.resume=Date.now()-a.resume;else{do{var m=d[g].event;"SetTempo"===m.subtype&&(a.tempo=
m.data[0]);"ControlChange"===m.subtype&&111===m.parameter1&&(f[0]={pos:g});if("Marker"===m.subtype&&("A"===m.data[0]&&(f[0]={pos:g}),"B"===m.data[0]&&a.enableFalcomLoop&&f[0]&&"number"===typeof f[0].pos)){g=f[0].pos;a.timer=a.window.setTimeout(n,0);a.position=g;return}if("Marker"===m.subtype&&(m=m.data[0].match(/^LOOP_(START|END)=ID:(\d+),COUNT:(-?\d+)$/)))if("START"===m[1])f[m[2]|0]=f[m[2]]||{pos:g,count:m[3]|0};else if("END"===m[1]&&a.enableMFiLoop){l=f[m[2]|0];if(0!==l.count){0<l.count&&l.count--;
g=l.pos;a.timer=a.window.setTimeout(n,0);a.position=g;return}f[m[2]|0]=null}k.postMessage(d[g++].webMidiLink,"*")}while(g<e&&d[g].time===c);g<e?(h=Date.now()-h,a.timer=a.window.setTimeout(n,a.tempo/(1E3*b)*(d[g].time-c-h)*(1/a.tempoRate))):(a.ended(),a.pause=!0,a.enableCC111Loop&&f[0]&&"number"===typeof f[0].pos?g=f[0].pos:a.enableLoop&&(a.initSequence(),a.playSequence()));a.position=g;a.time=c}};this.pause?(this.timer=a.window.setTimeout(n,this.resume),this.pause=!1,this.resume=-1):this.timer=a.window.setTimeout(n,
this.tempo/1E3*b*this.track[0].time)}loadMidiFile(a){a=new k["default"](a);this.init();a.parse();this.mergeMidiTracks(a)}loadMldFile(a){a=new b.a(a);this.init();a.parse();this.loadMidiFile(a.convertToMidiTracks())}mergeMidiTracks(a){const b=this.track=[],c=a.tracks;var f=Array(c.length);const g=a.plainTracks,k=this.copyright=[];let n,t,p,l;n=0;for(t=c.length;n<t;++n)f[n]=0;n=0;for(t=c.length;n<t;++n)for(f=c[n],p=0,l=f.length;p<l;++p)0===a.formatType&&"SequenceTrackName"===f[p].subtype&&(this.sequenceName=
f[p].data[0]),"CopyrightNotice"===f[p].subtype&&k.push(f[p].data[0]),b.push({track:n,eventId:p,time:f[p].time,event:f[p],webMidiLink:"midi,"+Array.prototype.map.call(g[n][p],a=>a.toString(16)).join(",")});b.sort((a,b)=>a.time>b.time?1:a.time<b.time?-1:a.track>b.track?1:a.track<b.track?-1:a.eventId>b.eventId?1:a.eventId<b.eventId?-1:0);this.timeTotal=b.slice(-1)[0].time;this.sequence=a}getSequenceName(){return this.sequenceName}getCopyright(){return this.copyright}getPosition(){return this.position}setPosition(a){this.position=
a}getLength(){return this.length}sendGmReset(){this.webMidiLink&&this.webMidiLink.contentWindow.postMessage("midi,F0,7E,7F,09,01,F7","*")}sendAllSoundOff(){this.webMidiLink&&this.webMidiLink.contentWindow.postMessage("midi,b0,78,0","*")}getTime(a){a*=this.tempo/6E6;const b=a%3600,c=Math.ceil(b%60);return Math.floor(a/3600)+":"+("00"+Math.floor(b/60)).slice(-2)+":"+("00"+c).slice(-2)}}}])});}).call(this || window)
