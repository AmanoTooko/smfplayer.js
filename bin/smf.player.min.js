/*! smfplayer.js vundefined | imaya / GREE Inc. / Logue | license: MIT */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Smf",[],t):"object"==typeof exports?exports.Smf=t():e.Smf=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function i(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(a,s,function(t){return e[t]}.bind(null,s));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){"use strict";i.r(t);class a{constructor(e,t){t=t||{},this.input=e,this.ip=t.index||0,this.length=t.length||e.length-this.ip,this.chunkList,this.offset=this.ip,this.padding=void 0===t.padding||t.padding,this.bigEndian=void 0!==t.bigEndian&&t.bigEndian}parse(){var e=this.length+this.offset;for(this.chunkList=[];this.ip<e;)this.parseChunk()}parseChunk(){var e,t=this.input,i=this.ip;this.chunkList.push({type:String.fromCharCode(t[i++],t[i++],t[i++],t[i++]),size:e=this.bigEndian?(t[i++]<<24|t[i++]<<16|t[i++]<<8|t[i++])>>>0:(t[i++]|t[i++]<<8|t[i++]<<16|t[i++]<<24)>>>0,offset:i}),i+=e,this.padding&&1==(i-this.offset&1)&&i++,this.ip=i}getChunk(e){var t=this.chunkList[e];return void 0===t?null:t}getNumberOfChunks(){return this.chunkList.length}}class s{constructor(e,t,i){this.subtype=e,this.deltaTime=t,this.time=i}}class r extends s{constructor(e,t,i,a,s,r){super(e,t,i),this.channel=a,this.parameter1=s,this.parameter2=r}}class n extends s{constructor(e,t,i,a){super(e,t,i),this.data=a}}class o extends s{constructor(e,t,i,a){super(e,t,i),this.data=a}}i.d(t,"default",function(){return u});class u{constructor(e,t={}){t.padding=!1,t.bigEndian=!0,this.input=e,this.ip=t.index||0,this.chunkIndex=0,this.riffParser_=new a(e,t),this.formatType=0,this.numberOfTracks=0,this.timeDivision=0,this.tracks=[],this.plainTracks=[]}parse(){let e=0,t=0;for(this.riffParser_.parse(),this.parseHeaderChunk(),e=0,t=this.numberOfTracks;e<t;++e)this.parseTrackChunk()}parseHeaderChunk(){const e=this.riffParser_.getChunk(this.chunkIndex++),t=this.input;let i=e.offset;if(!e||"MThd"!==e.type)throw new Error("invalid header signature");this.formatType=t[i++]<<8|t[i++],this.numberOfTracks=t[i++]<<8|t[i++],this.timeDivision=t[i++]<<8|t[i++]}parseTrackChunk(){const e=this.riffParser_.getChunk(this.chunkIndex++),t=this.input;let i,a,s=e.offset,u=0,h=0,l=0,c=0,p=-1,d=-1,m=0,f=0,b=0,y=0,k=0;const g=()=>{let e=0,i=0;do{e=e<<7|127&(i=t[s++])}while(0!=(128&i));return e};if(!e||"MTrk"!==e.type)throw new Error("invalid header signature");u=e.offset+e.size;let w=[],v=[];for(;s<u;){f+=h=g(),b=s,c=15&(k=t[s++]),(l=k>>4&15)<8?(l=p,c=d,k=p<<4|d,s--,b--):(p=l,d=c);const e=[,,,,,,,,"NoteOff","NoteOn","NoteAftertouch","ControlChange","ProgramChange","ChannelAftertouch","PitchBend"];switch(l){case 8:case 9:case 10:case 11:case 13:case 14:i=new r(e[l],h,f,c,t[s++],t[s++]);break;case 12:i=new r(e[l],h,f,c,t[s++]);break;case 15:switch(c){case 0:if(m=g(),247!==t[s+m-1])throw new Error("invalid SysEx event");i=new n("SystemExclusive",h,f,t.subarray(s,(s+=m)-1));break;case 7:m=g(),i=new n("SystemExclusive(F7)",h,f,t.subarray(s,s+=m));break;case 15:switch(l=t[s++],m=g(),l){case 0:i=new o("SequenceNumber",h,f,[t[s++],t[s++]]);break;case 1:i=new o("TextEvent",h,f,[String.fromCharCode.apply(null,t.subarray(s,s+=m))]);break;case 2:i=new o("CopyrightNotice",h,f,[String.fromCharCode.apply(null,t.subarray(s,s+=m))]);break;case 3:i=new o("SequenceTrackName",h,f,[String.fromCharCode.apply(null,t.subarray(s,s+=m))]);break;case 4:i=new o("InstrumentName",h,f,[String.fromCharCode.apply(null,t.subarray(s,s+=m))]);break;case 5:i=new o("Lyrics",h,f,[String.fromCharCode.apply(null,t.subarray(s,s+=m))]);break;case 6:i=new o("Marker",h,f,[String.fromCharCode.apply(null,t.subarray(s,s+=m))]);break;case 7:i=new o("CuePoint",h,f,[String.fromCharCode.apply(null,t.subarray(s,s+=m))]);break;case 32:i=new o("MidiChannelPrefix",h,f,[t[s++]]);break;case 47:i=new o("EndOfTrack",h,f,[]);break;case 81:i=new o("SetTempo",h,f,[t[s++]<<16|t[s++]<<8|t[s++]]);break;case 84:i=new o("SmpteOffset",h,f,[t[s++],t[s++],t[s++],t[s++],t[s++]]);break;case 88:i=new o("TimeSignature",h,f,[t[s++],t[s++],t[s++],t[s++]]);break;case 89:i=new o("KeySignature",h,f,[t[s++],t[s++]]);break;case 127:i=new o("SequencerSpecific",h,f,[t.subarray(s,s+=m)]);break;default:i=new o("Unknown",h,f,[l,t.subarray(s,s+=m)])}break;default:console.log("unknown message:",k.toString(16))}break;default:throw new Error("invalid status")}y=s-b,(a=t.subarray(b,b+y))[0]=k,i instanceof r&&"NoteOn"===i.subtype&&0===i.parameter2&&(i.subtype=e[8],a=new Uint8Array([128|i.channel,i.parameter1,i.parameter2])),v.push(a),w.push(i)}this.tracks.push(w),this.plainTracks.push(v)}}},function(e,t,i){"use strict";i.r(t);var a=i(0);class s{constructor(e,t){t=t||{},this.input=e,this.ip=t.index||0,this.header,this.dataInformation,this.tracks}parse(){this.parseHeader(),this.parseDataInformation(),this.parseTracks()}parseHeader(){let e=this.input,t=this.ip,i=this.header={},a=String.fromCharCode(e[t++],e[t++],e[t++],e[t++]);if("melo"!==a)throw new Error("invalid MFi signature:"+a);i.fileLength=(e[t++]<<24|e[t++]<<16|e[t++]<<8|e[t++])>>>0,i.trackOffset=(e[t++]<<16|e[t++])+t,i.dataMajorType=e[t++],i.dataMinorType=e[t++],i.numberOfTracks=e[t++],this.ip=t}parseDataInformation(){let e,t,i=this.input,a=this.ip,s=this.dataInformation={copy:null,date:null,exst:null,note:null,prot:null,sorc:null,titl:null,trac:null,vers:null};for(;a<this.header.trackOffset;)switch(e=String.fromCharCode(i[a++],i[a++],i[a++],i[a++]),t=i[a++]<<8|i[a++],e){case"titl":case"copy":case"vers":case"date":case"prot":s[e]=String.fromCharCode.apply(null,i.subarray(a,a+=t));break;case"sorc":s[e]=i[a++];break;case"note":s[e]=i[a++]<<8|i[a++];break;case"exst":break;default:s[e]=i.subarray(a,a+=t)}this.ip=a}parseTracks(){let e,t,i,a,s,r,n,o,u,h,l,c=this.input,p=this.ip,d=this.tracks=[];for(h=0,l=this.header.numberOfTracks;h<l;++h){if("trac"!==(e=String.fromCharCode(c[p++],c[p++],c[p++],c[p++])))throw new Error("invalid track signature:"+e);for(t=c[p++]<<24|c[p++]<<16|c[p++]<<8|c[p++],i=p+t,u=d[h]=[];p<i;){if((o={key:null,length:null,octaveShift:null,subType:null,type:null,value:{},velocity:null,voice:null}).deltaTime=a=c[p++],255!==(s=c[p++]))o.type="note",o.subType="Note",o.voice=s>>6,o.key=63&s,r=o.length=c[p++],1===this.dataInformation.note&&(n=c[p++],o.velocity=n>>2,o.octaveShift=3&n);else switch(o.type="meta",(s=c[p++])>>4){case 11:switch(15&s){case 0:o.subType="MasterVolume",o.value=c[p++];break;case 10:o.subType="DrumScale",o.value={channel:c[p]>>3&7,drum:1&c[p++]};break;default:throw new Error("unknown message type:"+s.toString(16))}break;case 12:o.subType="SetTempo",o.value={timeBase:7==(7&s)?NaN:Math.pow(2,7&s)*(0==(8&s)?6:15),tempo:c[p++]};break;case 13:switch(15&s){case 0:o.subType="Point",o.value=c[p++];break;case 13:o.subType="Loop",o.value={id:c[p]>>6,count:c[p]>>2&15,point:3&c[p++]};break;case 14:o.subType="Nop",o.value=c[p++];break;case 15:o.subType="EndOfTrack",o.value=c[p++];break;default:throw new Error("unkwnon message type:"+s.toString(16))}break;case 14:switch(15&s){case 0:o.subType="InstrumentLowPart",o.value={part:c[p]>>6,instrument:63&c[p++]};break;case 1:o.subType="InstrumentHighPart",o.value={part:c[p]>>6,instrument:1&c[p++]};break;case 2:o.subType="Volume",o.value={part:c[p]>>6,volume:63&c[p++]};break;case 3:o.subType="Valance",o.value={part:c[p]>>6,valance:63&c[p++]};break;case 4:o.subType="PitchBend",o.value={part:c[p]>>6,value:63&c[p++]};break;case 5:o.subType="ChannelAssign",o.value={part:c[p]>>6,channel:63&c[p++]};break;case 6:o.subType="VolumeChange",o.value={part:c[p]>>6,volume:(63&c[p++])<<26>>26};break;case 7:o.subType="PitchBendRange",o.value={part:c[p]>>6,value:63&c[p++]};break;case 9:o.subType="MasterCoarseTuning",o.value={part:c[p]>>6,value:63&c[p++]};break;case 10:o.subType="Modulation",o.value={part:c[p]>>6,depth:63&c[p++]};break;default:throw new Error("unkwnon message type:"+s.toString(16))}break;case 15:switch(15&s){case 0:o.subType="EditInstrument",o.value=m();break;case 1:o.subType="Vibrato",o.value=f();break;case 15:o.subType="DeviceSpecific",o.value=b();break;default:throw new Error("unkwnon message type:"+s.toString(16))}break;default:throw new Error("unkwnon message type:"+s.toString(16))}u.push(o)}p=i}function m(){let e,t=c[p++]<<8|c[p++],i=p+t,a=[];if(1!==c[p++])throw new Error("invalid EditInstrument const value:"+c[p-1]);for(;p<i;)(e={}).part=c[p++]>>4&3,e.modulator={ML:c[p]>>5,VIV:c[p]>>4&1,EG:c[p]>>3&1,SUS:c[p]>>2&1,RR:(3&c[p++])<<2|c[p]>>6,DR:c[p]>>4&15,AR:(3&c[p++])<<2|c[p]>>6,SL:c[p]>>4&15,TL:(3&c[p++])<<4|c[p]>>4,WF:c[p]>>3&1,FB:7&c[p++]},e.carrier={ML:c[p]>>5,VIV:c[p]>>4&1,EG:c[p]>>3&1,SUS:c[p]>>2&1,RR:(3&c[p++])<<2|c[p]>>6,DR:c[p]>>4&15,AR:(3&c[p++])<<2|c[p]>>6,SL:c[p]>>4&15,TL:(3&c[p++])<<4|c[p]>>4,WF:c[p]>>3&1,FB:7&c[p++]},e.octaveSelect=3&c[p++],a.push(e);return a}function f(){c[p++],c[p++];if(1!==c[p++])throw new Error("invalid Vibrato const value:"+c[p-1]);return{part:c[p++]>>5&3,switch:c[p++]>>6}}function b(){let e=c[p++]<<8|c[p++],t=p+e;if(17!==c[p++])throw new Error("invalid DeviceSpecific const value:"+c[p-1]);return{data:c.subarray(p,p+=t-p)}}this.ip=p}convertToMidiTracks(){let e,t,i,a,s,r,n,o,u,h,l,c,p,d,m={timeDivision:48,trac:[],plainTracks:[]},f=m.tracks,b=m.plainTracks,y=this.tracks,k=[];for(h=0;h<16;++h)b[h]=[],k[h]=0;for(h=0,l=y.length;h<l;++h){for(a=[],s=r=c=0,p=(e=y[h]).length;c<p;++c)switch(s+=(t=e[c]).deltaTime,t.id=r,t.time=s,t.subType){case"Nop":break;case"Note":a[r++]=t,a[r]={id:r,type:"internal",subType:"NoteOff",time:s+t.length,key:t.key,voice:t.voice,velocity:t.velocity,octaveShift:t.octaveShift},r++;break;case"InstrumentHighPart":if(i=t,"InstrumentLowPart"!==(t=e[++c]).subType)throw new Error("broken instrument");a[r]={id:r,type:"internal",subType:"ProgramChange",time:s,part:t.value.part,instrument:i.value.instrument<<6|t.value.instrument},r++;break;default:a[r++]=t}for(a.sort(function(e,t){return e.time>t.time?1:e.time<t.time?-1:e.id>t.id?1:e.id<t.id?-1:0}),f[h]=[],s=c=0,p=a.length;c<p;++c){switch(s=(t=a[c]).time,t.subType){case"Note":n=this.applyOctaveShift(t.key+45,t.octaveShift),9===(d=4*h+t.voice)&&(n-=10),b[d].push(this.deltaTimeToByteArray(s-k[d]).concat(144|d,n,2*t.velocity));break;case"NoteOff":n=this.applyOctaveShift(t.key+45,t.octaveShift),9===(d=4*h+t.voice)&&(n-=10),b[d].push(this.deltaTimeToByteArray(s-k[d]).concat(128|d,n,2*t.velocity));break;case"ProgramChange":b[d=4*h+t.part].push(this.deltaTimeToByteArray(s-k[d]).concat(192|d,t.instrument));break;case"SetTempo":o=288e7/(t.value.tempo*t.value.timeBase),b[d=0].push(this.deltaTimeToByteArray(s-k[d]).concat(255,81,3,o>>16&255,o>>8&255,255&o));break;case"Loop":o=t.value.count,u="LOOP_"+(0===t.value.point?"START":"END")+"=ID:"+t.value.id+",COUNT:"+(0===o?-1:o),b[d=0].push(this.deltaTimeToByteArray(s-k[d]).concat([255,6,u.length],u.split("").map(function(e){return e.charCodeAt(0)})));break;case"MasterVolume":o=t.value,b[d=0].push(this.deltaTimeToByteArray(s-k[d]).concat(240,7,127,127,4,1,o,o,247));break;case"Modulation":b[d=4*h+t.value.part].push(this.deltaTimeToByteArray(s-k[d]).concat(176|d,1,2*t.value.depth));break;case"Volume":b[d=4*h+t.value.part].push(this.deltaTimeToByteArray(s-k[d]).concat(176|d,7,2*t.value.volume));break;case"Valance":b[d=4*h+t.value.part].push(this.deltaTimeToByteArray(s-k[d]).concat(176|d,10,2*(t.value.valance-32)+64));break;case"PitchBend":b[d=4*h+t.value.part].push(this.deltaTimeToByteArray(s-k[d]).concat(224|d,2*t.value.value,2*t.value.value));break;case"PitchBendRange":b[d=4*h+t.value.part].push(this.deltaTimeToByteArray(s-k[d]).concat(176|d,100,0),[0,176|d,101,0],[0,176|d,6,2*t.value.value]);break;case"MasterCoarseTuning":b[d=4*h+t.value.part].push(this.deltaTimeToByteArray(s-k[d]).concat(176|d,100,0),[0,176|d,101,2],[0,176|d,6,2*t.value.value]);break;default:continue}k[d]=t.time}}return this.toSMF(b)}applyOctaveShift(e,t){let i=[0,12,-24,-12];if(void 0!==i[t])return e+i[t];throw new Error("invalid OctaveShift value:"+t)}toSMF(e){let t,i,a,s,r,n,o=[77,84,104,100,0,0,0,6,0,1,0,16,0,48];if(void 0!==this.dataInformation.copy){let t=function(e){let t,i=e.length,a=new Array(i);for(t=0;t<i;++t)a[t]=e.charCodeAt(t);return a}(this.dataInformation.copy);s=t.length,t=[0,255,2].concat(this.deltaTimeToByteArray(s),t),e[0].unshift(t)}for(a=0,s=e.length;a<s;++a){let s=e[a];for(i=[],r=0,n=s.length;r<n;++r)Array.prototype.push.apply(i,s[r]);t=[77,84,114,107,(n=i.length)>>24&255,n>>16&255,n>>8&255,255&n],o=o.concat(t,i)}return new Uint8Array(o)}deltaTimeToByteArray(e){let t=[];for(;e>=128;)t.unshift(127&e|(0===t.length?0:128)),e>>>=7;return t.unshift(e|(0===t.length?0:128)),t}}i.d(t,"Player",function(){return r});class r{constructor(e="#wml"){this.tempo=5e5,this.webMidiLink,this.resume,this.pause=!0,this.ready=!1,this.position=0,this.track=[],this.timer=0,this.sequence={},this.enableCC111Loop=!1,this.enableFalcomLoop=!1,this.enableMFiLoop=!1,this.enableLoop=!1,this.tempoRate=1,this.masterVolume=16383,this.sequenceName="",this.copyright=[],this.webMidiLink=null,this.length=0,this.time=0,this.timeTotal,this.loaded=0,this.window=window,this.target=this.window.document.querySelector(e)}setCC111Loop(e){this.enableCC111Loop=e}setFalcomLoop(e){this.enableFalcomLoop=e}setMFiLoop(e){this.enableMFiLoop=e}setLoop(e){this.enableLoop=e}stop(){let e;if(this.pause=!0,this.resume=Date.now(),this.webMidiLink)for(e=0;e<16;++e)this.webMidiLink.contentWindow.postMessage("midi,b"+e.toString(16)+",78,0","*")}getWebMidiLink(){return this.webMidiLink}init(){this.stop(),this.initSequence(),this.pause=!0,this.track=null,this.resume=-1,this.sequence=null,this.sequenceName=null,this.copyright=null,this.length=0,this.position=0,this.time=0,this.timeTotal=0,this.window.clearTimeout(this.timer);let e=this;this.ready?this.sendInitMessage():this.window.addEventListener("message",function(t){"link,ready"===t.data&&e.sendInitMessage()},!1)}initSequence(){this.tempo=5e5,this.position=0,this.sendInitMessage(),this.pause=!1}play(){let e=this;if(!this.webMidiLink)throw new Error("WebMidiLink not found");this.ready?this.track?(this.length=this.track.length,this.track instanceof Array&&this.position>=this.length&&(this.position=0),this.playSequence()):console.warn("Midi file is not loaded."):this.window.addEventListener("message",function(t){"link,ready"===t.data&&(e.ready=!0,e.playSequence())},!1)}ended(){player.window.postMessage("endoftrack","*")}sendInitMessage(){let e,t=this.webMidiLink.contentWindow;for(e=0;e<16;++e)t.postMessage("midi,b"+e.toString(16)+",128,0","*"),t.postMessage("midi,b"+e.toString(16)+",07,64","*"),t.postMessage("midi,b"+e.toString(16)+",0a,40","*"),t.postMessage("midi,e"+e.toString(16)+",00,40","*"),t.postMessage("midi,b"+e.toString(16)+",64,00","*"),t.postMessage("midi,b"+e.toString(16)+",65,00","*"),t.postMessage("midi,b"+e.toString(16)+",06,02","*"),t.postMessage("midi,b"+e.toString(16)+",26,00","*");this.sendGmReset()}setWebMidiLink(e="./wml.html"){const t=this,i=e=>{if("string"==typeof e.data){const i=e.data.split(",");"link"===i[0]&&("ready"===i[1]?(t.ready=!0,t.loaded=100,t.setMasterVolume(t.masterVolume)):"progress"===i[1]&&(t.loaded=Math.round(i[2]/i[3]*1e4)))}};if("string"==typeof e){let t;this.webMidiLink&&this.webMidiLink.parentNode.removeChild(this.webMidiLink),this.target.firstChild&&this.target.removeChild(this.target.firstChild),(t=this.webMidiLink=this.window.document.createElement("iframe")).src=e,t.className="wml",this.target.appendChild(t),this.window.addEventListener("message",i,!1)}else this.webMidiLink.addEventListener("message",i,!1)}setMasterVolume(e){this.masterVolume=e,this.webMidiLink&&this.webMidiLink.contentWindow.postMessage("midi,f0,7f,7f,04,01,"+[("0"+(127&e).toString(16)).substr(-2),("0"+(e>>7&127).toString(16)).substr(-2),"7f"].join(","),"*")}setTempoRate(e){this.tempoRate=e}playSequence(){const e=this;let t=this.sequence.timeDivision,i=this.track,a=this.webMidiLink.contentWindow,s=this.position||0,r=[];const n=()=>{let o,u,h,l=i[s].time,c=i.length,p=Date.now();if(e.pause)e.resume=Date.now()-e.resume;else{do{if("SetTempo"===(o=i[s].event).subtype&&(e.tempo=o.data[0]),"ControlChange"===o.subtype&&111===o.parameter1&&(r[0]={pos:s}),"Marker"===o.subtype&&("A"===o.data[0]&&(r[0]={pos:s}),"B"===o.data[0]&&e.enableFalcomLoop&&r[0]&&"number"==typeof r[0].pos))return s=r[0].pos,e.timer=e.window.setTimeout(n,0),void(e.position=s);if("Marker"===o.subtype&&(u=o.data[0].match(/^LOOP_(START|END)=ID:(\d+),COUNT:(-?\d+)$/)))if("START"===u[1])r[0|u[2]]=r[u[2]]||{pos:s,count:0|u[3]};else if("END"===u[1]&&e.enableMFiLoop){if(0!==(h=r[0|u[2]]).count)return h.count>0&&h.count--,s=h.pos,e.timer=e.window.setTimeout(n,0),void(e.position=s);r[0|u[2]]=null}a.postMessage(i[s++].webMidiLink,"*")}while(s<c&&i[s].time===l);s<c?(p=Date.now()-p,e.timer=e.window.setTimeout(n,e.tempo/(1e3*t)*(i[s].time-l-p)*(1/e.tempoRate))):(e.ended(),e.pause=!0,e.enableCC111Loop&&r[0]&&"number"==typeof r[0].pos?s=r[0].pos:e.enableLoop&&(e.initSequence(),e.playSequence())),e.position=s,e.time=l}};this.pause?(this.timer=e.window.setTimeout(n,this.resume),this.pause=!1,this.resume=-1):this.timer=e.window.setTimeout(n,this.tempo/1e3*t*this.track[0].time)}loadMidiFile(e){let t=new a.default(e);this.init(),t.parse(),this.mergeMidiTracks(t)}loadMldFile(e){let t=new s(e);this.init(),t.parse(),this.loadMidiFile(t.convertToMidiTracks())}mergeMidiTracks(e){let t,i,a,s,r,n,o,u,h=this.track=[],l=this.copyright=[];for(i=e.tracks,t=new Array(i.length),s=e.plainTracks,r=0,n=i.length;r<n;++r)t[r]=0;for(r=0,n=i.length;r<n;++r)for(o=0,u=(a=i[r]).length;o<u;++o)0===e.formatType&&"SequenceTrackName"===a[o].subtype&&(this.sequenceName=a[o].data[0]),"CopyrightNotice"===a[o].subtype&&l.push(a[o].data[0]),h.push({track:r,eventId:o,time:a[o].time,event:a[o],webMidiLink:"midi,"+Array.prototype.map.call(s[r][o],function(e){return e.toString(16)}).join(",")});h.sort(function(e,t){return e.time>t.time?1:e.time<t.time?-1:e.track>t.track?1:e.track<t.track?-1:e.eventId>t.eventId?1:e.eventId<t.eventId?-1:0}),this.timeTotal=h.slice(-1)[0].time,this.sequence=e}getSequenceName(){return this.sequenceName}getCopyright(){return this.copyright}getPosition(){return this.position}setPosition(e){this.position=e}getLength(){return this.length}sendGmReset(){this.webMidiLink&&this.webMidiLink.contentWindow.postMessage("midi,F0,7E,7F,09,01,F7","*")}sendAllSoundOff(){this.webMidiLink&&this.webMidiLink.contentWindow.postMessage("midi,b0,78,0","*")}getTime(e){let t=this.tempo/6e6*e,i=Math.floor(t/3600),a=t%3600,s=Math.floor(a/60),r=a%60,n=Math.ceil(r);return i+":"+("00"+s).slice(-2)+":"+("00"+n).slice(-2)}}}])});