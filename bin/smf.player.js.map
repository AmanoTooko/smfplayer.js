{"version":3,"sources":["webpack://SMF/webpack/universalModuleDefinition","webpack://SMF/webpack/bootstrap","webpack://SMF/./node_modules/ini/ini.js","webpack://SMF/./src/3mle.js","webpack://SMF/./src/PSGConverter.js","webpack://SMF/./src/meta.js","webpack://SMF/./src/midi_event.js","webpack://SMF/./src/mld.js","webpack://SMF/./src/mmi.js","webpack://SMF/./src/mms.js","webpack://SMF/./src/ms2mml.js","webpack://SMF/./src/player.js","webpack://SMF/./src/riff.js","webpack://SMF/./src/smf.js"],"names":["ThreeMacroLanguageEditor","MakiMabiSequence","constructor","input","optParams","parse","parseHeader","parseTracks","toPlainTrack","header","Settings","encoder","TextEncoder","Encoding","title","Title","author","Source","timeDivision","TimeBase","headerTrack","push","SystemExclusiveEvent","MetaEvent","Memo","TimeSignatureNN","TimeSignatureDD","tracks","endTimes","mmls","settings","block","hasOwnProperty","match","RegExp","$1","Object","keys","join","replace","name","Name","instrument","Patch","panpot","Pan","data","no","mml","part","ch","track","ChannelEvent","mml2Midi","PSGConverter","channel","timeOffset","concat","events","endTime","Math","max","numberOfTracks","length","PATTERN","NOTE_TABLE","c","d","e","f","g","a","b","MINIM","SEMIBREVE","VELOCITY_MAGNIFICATION","plainEvents","noteOffNegativeOffset","ignoreTempo","igonreTempo","maxOctave","minOctave","octaveMode","minNote","maxNote","toLowerCase","console","warn","time","currentSoundLength","currentNote","currentVelocity","currentOctave","tieEnabled","message","tick","command","value","$2","$4","floor","$3","note","$5","Meta","version","date","Event","subtype","deltaTime","optParameter1","optParameter2","parameter1","parameter2","Mld","ip","index","dataInformation","parseDataInformation","signature","String","fromCharCode","Error","fileLength","trackOffset","dataMajorType","dataMinorType","copy","exst","prot","sorc","titl","trac","vers","type","size","apply","subarray","limit","status","extendStatus","i","il","parseEditInstrument","result","info","modulator","ML","VIV","EG","SUS","RR","DR","AR","SL","TL","WF","FB","carrier","octaveSelect","parseVibrato","switch","parseDeviceSpecific","key","octaveShift","subType","velocity","voice","noteLength","drum","toString","timeBase","NaN","pow","tempo","id","count","point","volume","valance","depth","convertToMidiTracks","plainTracks","mfiTracks","mfiTrack","mfiEvent","prevEvent","tmpTrack","pos","tmp","str","j","jl","channelTime","sort","applyOctaveShift","deltaTimeToByteArray","split","map","charCodeAt","toSMF","table","TimeDivision","trackHeader","trackData","stringToArray","array","Array","unshift","prototype","Uint8Array","MabiIcco","Uint16Array","multipleKeys","ret","trackNo","line","trim","includes","mmiTempo","timeSig","current","program","songProgram","chord","currentCh","igonoreTempo","string","Ini","infomation","auther","mmsInstTable","rythmNum","rythmBase","ch0_mml","ch1_mml","ch2_mml","Number","rawTrackEvents","rawEvents","event","raw","encode","MapleStory2Mml","parser","DOMParser","doc","parseFromString","querySelectorAll","textContent","Player","target","webMidiLink","resume","pause","ready","position","timer","sequence","enableCC111Loop","enableFalcomLoop","enableMFiLoop","enableLoop","tempoRate","masterVolume","textEvent","sequenceName","copyright","lyrics","timeTotal","loaded","window","document","querySelector","build","setCC111Loop","enable","setFalcomLoop","setMFiLoop","setLoop","stop","Date","now","contentWindow","postMessage","getWebMidiLink","init","initSequence","text","clearTimeout","player","sendInitMessage","addEventListener","ev","play","playSequence","style","height","body","scrollHeight","ended","win","sendGmReset","setWebMidiLink","port","process","msg","setMasterVolume","round","parentNode","removeChild","firstChild","iframe","createElement","src","className","appendChild","resizeHeight","setTimeout","substr","setTempoRate","mergedTrack","mark","update","procTime","loadMidiFile","buffer","SMF","mergeMidiTracks","loadMldFile","loadMs2MmlFile","loadMakiMabiSequenceFile","load3MleFile","loadMabiIccoFile","midi","trackPosition","formatType","eventId","call","slice","getSequenceName","getCopyright","getLyrics","getTextEvent","getPosition","setPosition","getLength","sendAllSoundOff","getTime","secs","hours","divisorForMinutes","minutes","divisorForSeconds","seconds","ceil","Riff","chunkList","offset","padding","bigEndian","parseChunk","RiffChunk","getChunk","chunk","getNumberOfChunks","chunkIndex","riffParser_","parseHeaderChunk","parseTrackChunk","eventType","prevEventType","prevChannel","totalTime","plainBytes","readNumber","eventQueue","plainQueue"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;QCVA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;;AAEH,MAAM,GAAG,IAAI,QAAQ,KAAK,MAAM,GAAG,OAAO;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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","file":"smf.player.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"SMF\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SMF\"] = factory();\n\telse\n\t\troot[\"SMF\"] = factory();\n})((typeof self !== 'undefined' ? self : this), function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/player.js\");\n","exports.parse = exports.decode = decode\n\nexports.stringify = exports.encode = encode\n\nexports.safe = safe\nexports.unsafe = unsafe\n\nvar eol = typeof process !== 'undefined' &&\n  process.platform === 'win32' ? '\\r\\n' : '\\n'\n\nfunction encode (obj, opt) {\n  var children = []\n  var out = ''\n\n  if (typeof opt === 'string') {\n    opt = {\n      section: opt,\n      whitespace: false\n    }\n  } else {\n    opt = opt || {}\n    opt.whitespace = opt.whitespace === true\n  }\n\n  var separator = opt.whitespace ? ' = ' : '='\n\n  Object.keys(obj).forEach(function (k, _, __) {\n    var val = obj[k]\n    if (val && Array.isArray(val)) {\n      val.forEach(function (item) {\n        out += safe(k + '[]') + separator + safe(item) + '\\n'\n      })\n    } else if (val && typeof val === 'object') {\n      children.push(k)\n    } else {\n      out += safe(k) + separator + safe(val) + eol\n    }\n  })\n\n  if (opt.section && out.length) {\n    out = '[' + safe(opt.section) + ']' + eol + out\n  }\n\n  children.forEach(function (k, _, __) {\n    var nk = dotSplit(k).join('\\\\.')\n    var section = (opt.section ? opt.section + '.' : '') + nk\n    var child = encode(obj[k], {\n      section: section,\n      whitespace: opt.whitespace\n    })\n    if (out.length && child.length) {\n      out += eol\n    }\n    out += child\n  })\n\n  return out\n}\n\nfunction dotSplit (str) {\n  return str.replace(/\\1/g, '\\u0002LITERAL\\\\1LITERAL\\u0002')\n    .replace(/\\\\\\./g, '\\u0001')\n    .split(/\\./).map(function (part) {\n      return part.replace(/\\1/g, '\\\\.')\n      .replace(/\\2LITERAL\\\\1LITERAL\\2/g, '\\u0001')\n    })\n}\n\nfunction decode (str) {\n  var out = {}\n  var p = out\n  var section = null\n  //          section     |key      = value\n  var re = /^\\[([^\\]]*)\\]$|^([^=]+)(=(.*))?$/i\n  var lines = str.split(/[\\r\\n]+/g)\n\n  lines.forEach(function (line, _, __) {\n    if (!line || line.match(/^\\s*[;#]/)) return\n    var match = line.match(re)\n    if (!match) return\n    if (match[1] !== undefined) {\n      section = unsafe(match[1])\n      p = out[section] = out[section] || {}\n      return\n    }\n    var key = unsafe(match[2])\n    var value = match[3] ? unsafe(match[4]) : true\n    switch (value) {\n      case 'true':\n      case 'false':\n      case 'null': value = JSON.parse(value)\n    }\n\n    // Convert keys with '[]' suffix to an array\n    if (key.length > 2 && key.slice(-2) === '[]') {\n      key = key.substring(0, key.length - 2)\n      if (!p[key]) {\n        p[key] = []\n      } else if (!Array.isArray(p[key])) {\n        p[key] = [p[key]]\n      }\n    }\n\n    // safeguard against resetting a previously defined\n    // array by accidentally forgetting the brackets\n    if (Array.isArray(p[key])) {\n      p[key].push(value)\n    } else {\n      p[key] = value\n    }\n  })\n\n  // {a:{y:1},\"a.b\":{x:2}} --> {a:{y:1,b:{x:2}}}\n  // use a filter to return the keys that have to be deleted.\n  Object.keys(out).filter(function (k, _, __) {\n    if (!out[k] ||\n      typeof out[k] !== 'object' ||\n      Array.isArray(out[k])) {\n      return false\n    }\n    // see if the parent section is also an object.\n    // if so, add it to that, and mark this one for deletion\n    var parts = dotSplit(k)\n    var p = out\n    var l = parts.pop()\n    var nl = l.replace(/\\\\\\./g, '.')\n    parts.forEach(function (part, _, __) {\n      if (!p[part] || typeof p[part] !== 'object') p[part] = {}\n      p = p[part]\n    })\n    if (p === out && nl === l) {\n      return false\n    }\n    p[nl] = out[k]\n    return true\n  }).forEach(function (del, _, __) {\n    delete out[del]\n  })\n\n  return out\n}\n\nfunction isQuoted (val) {\n  return (val.charAt(0) === '\"' && val.slice(-1) === '\"') ||\n    (val.charAt(0) === \"'\" && val.slice(-1) === \"'\")\n}\n\nfunction safe (val) {\n  return (typeof val !== 'string' ||\n    val.match(/[=\\r\\n]/) ||\n    val.match(/^\\[/) ||\n    (val.length > 1 &&\n     isQuoted(val)) ||\n    val !== val.trim())\n      ? JSON.stringify(val)\n      : val.replace(/;/g, '\\\\;').replace(/#/g, '\\\\#')\n}\n\nfunction unsafe (val, doUnesc) {\n  val = (val || '').trim()\n  if (isQuoted(val)) {\n    // remove the single quotes before calling JSON.parse\n    if (val.charAt(0) === \"'\") {\n      val = val.substr(1, val.length - 2)\n    }\n    try { val = JSON.parse(val) } catch (_) {}\n  } else {\n    // walk the val to find the first not-escaped ; character\n    var esc = false\n    var unesc = ''\n    for (var i = 0, l = val.length; i < l; i++) {\n      var c = val.charAt(i)\n      if (esc) {\n        if ('\\\\;#'.indexOf(c) !== -1) {\n          unesc += c\n        } else {\n          unesc += '\\\\' + c\n        }\n        esc = false\n      } else if (';#'.indexOf(c) !== -1) {\n        break\n      } else if (c === '\\\\') {\n        esc = true\n      } else {\n        unesc += c\n      }\n    }\n    if (esc) {\n      unesc += '\\\\'\n    }\n    return unesc.trim()\n  }\n  return val\n}\n","import PSGConverter from './PSGConverter';\nimport { MetaEvent, ChannelEvent, SystemExclusiveEvent } from './midi_event';\nimport MakiMabiSequence from './mms';\n/**\n * @classdesc   Three Macro Language Editor (3MLE) mml file Parser\n *\n * @author      Logue <logue@hotmail.co.jp>\n * @copyright   2019 Masashi Yoshikawa <https://logue.dev/> All rights reserved.\n * @license     MIT\n */\nexport default class ThreeMacroLanguageEditor extends MakiMabiSequence {\n  /**\n   * @param {ByteArray} input\n   * @param {Object=} optParams\n   */\n  constructor(input, optParams = {}) {\n    super(input, optParams);\n  }\n  /**\n   */\n  parse() {\n    this.parseHeader();\n    this.parseTracks();\n    this.toPlainTrack();\n  };\n  /**\n   */\n  parseHeader() {\n    const header = this.input.Settings;\n    /** @type {TextEncoder} */\n    this.encoder = new TextEncoder(header.Encoding || 'shift_jis');\n    /** @param {string} */\n    this.title = header.Title;\n    /** @param {string} */\n    this.author = header.Source;\n    /** @param {number} */\n    this.timeDivision = header.TimeBase | 0 || 32;\n\n    // 曲名と著者情報を付加\n    /** @type {array}  */\n    const headerTrack = [];\n    // GM Reset\n    headerTrack.push(new SystemExclusiveEvent('SystemExclusive', 0, 0, [0x7e, 0x7f, 0x09, 0x01]));\n    headerTrack.push(new MetaEvent('SequenceTrackName', 0, 0, [this.title]));\n    headerTrack.push(new MetaEvent('CopyrightNotice', 0, 0, [this.author]));\n    headerTrack.push(new MetaEvent('TextEvent', 0, 0, [header.Memo]));\n    headerTrack.push(new MetaEvent('TimeSignature', 0, 0, [header.TimeSignatureNN | 0 || 4, header.TimeSignatureDD | 0 || 4, 0, 0]));\n    headerTrack.push(new MetaEvent('EndOfTrack', 0, 0));\n    this.tracks.push(headerTrack);\n\n    // 3MLE EXTENSION、Settingsを取り除く\n    delete this.input['3MLE EXTENSION'];\n    delete this.input.Settings;\n  };\n\n  /**\n   * MML parse\n   */\n  parseTracks() {\n    const input = this.input;\n    /** @type {array} 終了時間比較用 */\n    const endTimes = [];\n\n    /** @type {array} 各ブロックのMML */\n    const mmls = [];\n    /** @type {array} 各ブロックの演奏情報 */\n    const settings = [];\n\n    for (const block in input) {\n      if (input.hasOwnProperty(block)) {\n        if (block.match(/^Channel(\\d+)$/i)) {\n          // MMLは[Channel[n]]ブロックのキー\n\n          // ひどいファイル形式だ・・・。\n          mmls[(RegExp.$1 | 0) - 1] = Object.keys(input[block]).join('').replace(/\\/\\*([^*]|\\*[^\\/])*\\*\\//g, '');\n        }\n\n        if (block.match(/^ChannelProperty(\\d+)$/i)) {\n          // 各パートの楽器情報などは[ChannelProperty[n]]に格納されている\n          settings[(RegExp.$1 | 0) - 1] = {\n            name: input[block].Name,\n            instrument: input[block].Patch | 0,\n            panpot: input[block].Pan | 0,\n          };\n        }\n      }\n    }\n\n    /** @type {array} 整形済みデータ */\n    const data = [];\n\n    // データを整形\n    for (const no in mmls) {\n      if (mmls.hasOwnProperty(no)) {\n        if (settings[no] !== void 0) {\n          data[no] = {\n            mml: mmls[no],\n            name: settings[no].name || '',\n            instrument: settings[no].instrument || 0,\n            panpot: settings[no].panpot || 64,\n          };\n        } else {\n          data[no] = {\n            mml: mmls[no],\n            name: '',\n            instrument: 0,\n            panpot: 64,\n          };\n        }\n      }\n    }\n\n    // console.log(data);\n\n    for (const part in data) {\n      if (data.hasOwnProperty(part)) {\n        /** @type {number} */\n        const ch = part | 0;\n        /** @type {array} MIDIイベント */\n        let track = [];\n        if (data[part].mml === '') {\n          // 空っぽのMMLトラックの場合処理しない\n          continue;\n        }\n\n        // 楽器名\n        track.push(new MetaEvent('InsturumentName', 0, 48, [data[part].name]));\n        // プログラムチェンジ\n        track.push(new ChannelEvent('ProgramChange', 0, 96, ch, data[part].instrument));\n        // パン\n        track.push(new ChannelEvent('ControlChange', 0, 154, ch, 10, data[part].panpot));\n\n        /** @param {PSGConverter} */\n        const mml2Midi = new PSGConverter({ timeDivision: this.timeDivision, channel: ch, timeOffset: 386, mml: data[part].mml });\n        // トラックにマージ\n        track = track.concat(mml2Midi.events);\n        // 演奏時間を更新\n        endTimes.push(mml2Midi.endTime);\n\n        // トラック終了\n        track.concat(new MetaEvent('EndOfTrack', 0, Math.max(endTimes)));\n        this.tracks.push(track);\n      }\n    }\n    this.numberOfTracks = this.tracks.length;\n  }\n}\n","import { ChannelEvent, MetaEvent } from './midi_event';\n/**\n * @class       PSGConverter\n * @classdesc   Mabinogi MML and Maple Story 2 MML to MIDI Converter.\n * @version     3.0.2\n *\n * @author      Logue <logue@hotmail.co.jp>\n * @copyright   2019 Masashi Yoshikawa <https://logue.dev/> All rights reserved.\n * @license     MIT\n */\nexport default class PSGConverter {\n  /**\n   * Constructor\n   * @param {array} optParams\n   */\n  constructor(optParams = {}) {\n    /** @type {number} 分解能 */\n    this.timeDivision = optParams.timeDivision | 0 || 96;\n    /** @type {number} チャンネル（0～15） */\n    this.channel = optParams.channel | 0;\n    /** @type {number} 演奏開始までのオフセット時間 */\n    this.timeOffset = optParams.timeOffset | 0;\n    /** @type {string} MMLのチャンネルごとのマッチパターン */\n    this.PATTERN = /[a-glnortv<>][+#-]?[0-9]*\\.?&?/g;\n    /** @type {Array<string, number>} ノートのマッチングテーブル */\n    this.NOTE_TABLE = {\n      c: 0,\n      d: 2,\n      e: 4,\n      f: 5,\n      g: 7,\n      a: 9,\n      b: 11,\n    };\n    /** @type {number} １拍（Tick連動） */\n    this.MINIM = this.timeDivision * 2;\n    /** @type {number} 1小節 */\n    this.SEMIBREVE = this.timeDivision * 4;\n    /** @type {number} ベロシティの倍率 */\n    this.VELOCITY_MAGNIFICATION = 7; // 127÷15≒8.4\n    /** @type {array} MMLデータ */\n    this.mml = optParams.mml;\n    /** @type {array} イベント */\n    this.events = [];\n    /** @type {array} WML送信用イベント */\n    this.plainEvents = [];\n    /** @type {number} 終了時間 */\n    this.endTime = 0;\n    /** @type {number} ノートオフの逆オフセット(tick指定) */\n    this.noteOffNegativeOffset = 2;\n    /** @type {bool} テンポ命令を無視する */\n    this.ignoreTempo = optParams.igonreTempo | false;\n    /** @type {number} 最大オクターブ */\n    this.maxOctave = optParams.maxOctave | 8;\n    /** @type {number} 最小オクターブ */\n    this.minOctave = optParams.minOctave | 0;\n    /** @type {number} オクターブモード（0：処理しない。1：外れる音階はその前後のオクターブをループする。2：常に同じ音を鳴らす */\n    this.octaveMode = optParams.octaveMode | 0;\n    /** @type {number} 最低音階（octaveModeが0の場合は無視されます。デフォルトはピアノの音階。GM音源で再生するとき用） */\n    this.minNote = optParams.minNote | 12;\n    /** @type {number} 最高音階（octaveModeが0の場合は無視されます。デフォルトはピアノの音階。GM音源で再生するとき用） */\n    this.maxNote = optParams.minNote | 98;\n    // 変換実行\n    this.parse();\n  }\n\n  /**\n   * Parse MML\n   */\n  parse() {\n    /** @type {Array} MMLストリーム */\n    let mmls = [];\n    try {\n      // 小文字に変換した後正規表現で命令単位で分割する。\n      mmls = this.mml.toLowerCase().match(this.PATTERN);\n    } catch (e) {\n      console.warn('Could not parse MML.', this.mml);\n      return;\n    }\n\n    if (!mmls) {\n      // 空欄の場合処理しない\n      return;\n    }\n\n    /** @type {number} タイムスタンプ */\n    let time = this.timeOffset;\n    /** @type {number} 現在の音の長さ */\n    let currentSoundLength = this.timeDivision;\n    /** @type {number} 現在の音階 */\n    let currentNote = 0;\n    /** @type {number} ベロシティ(0～15) */\n    let currentVelocity = 8;\n    /** @type {number} オクターブ(0~8) */\n    let currentOctave = 4;\n    /** @type {bool} タイ記号 */\n    let tieEnabled = false;\n\n    /** @type {array} MIDIイベント */\n    const events = [];\n\n    // MMLを命令単位でパース\n    for (const message of mmls) {\n      /** @type {number} すすめるtick数 */\n      let tick = currentSoundLength | 0;\n      /** @type {string} コマンド */\n      let command = '';\n      /** @type {number} 値 */\n      let value = 0;\n\n      // 音長(L)、オクターブ(O<>)、テンポ（T）、ベロシティ（V）をパース\n      if (message.match(/([lotv<>])([1-9][0-9]*|0?)(\\.?)(&?)/)) {\n        command = RegExp.$1.toLowerCase();\n        value = RegExp.$2 | 0;\n\n        if (tieEnabled && RegExp.$4 !== '&') {\n          // タイ記号\n          tieEnabled = false;\n          events.push(\n            new ChannelEvent('NoteOff', 0, time - this.noteOffNegativeOffset, this.channel, currentNote),\n          );\n        }\n\n        switch (command) {\n          case 'l':\n            // 音長設定 Ln[.] (n=1～192)\n            if (value >= 1 && value <= this.MINIM) {\n              currentSoundLength = Math.floor(this.SEMIBREVE / value);\n              if (RegExp.$3 === '.') {\n                // 付点の場合音長を1.5倍する\n                currentSoundLength = Math.floor(currentSoundLength * 1.5);\n              }\n            }\n            break;\n          case 'o':\n            // オクターブ設定 On (n=1～8)\n            if (value >= this.minOctave && value <= this.maxOctave) {\n              currentOctave = value;\n            }\n            break;\n          case 't':\n            // テンポ設定 Tn (n=32～255)\n            events.push(\n              new MetaEvent('SetTempo', 0, time, [Math.floor(60000000 / value)]),\n            );\n            break;\n          case 'v':\n            // ベロシティ調整\n            if (value >= 0 && value <= 15) {\n              currentVelocity = value;\n            }\n            break;\n\n          // 簡易オクターブ設定 {<>}\n          case '<':\n            currentOctave = currentOctave <= this.minOctave ? this.minOctave : currentOctave - 1;\n            break;\n          case '>':\n            currentOctave = currentOctave >= this.maxOctave ? this.maxOctave : currentOctave + 1;\n            break;\n        }\n      } else if (message.match(/([a-gn])([+#-]?)([0-9]*)(\\.?)(&?)/)) {\n        // ノート命令（CDEFGAB）、絶対音階指定（N）をパース\n\n        /** @type {number} 音階 */\n        let note = 0;\n        command = RegExp.$1.toLowerCase();\n        value = RegExp.$3 | 0;\n\n        if (command === 'n') {\n          // Nn：絶対音階指定 Lで指定した長さに設定\n          note = value;\n        } else {\n          // [A-G]：音名表記\n          // 音符の長さ指定: n分音符→128分音符×tick数\n          if (value >= 1 && value <= this.MINIM) {\n            tick = Math.floor(this.SEMIBREVE / value); // L1 -> 384tick .. L64 -> 6tick\n          }\n          if (RegExp.$4 === '.') {\n            tick = Math.floor(tick * 1.5); // 付点つき -> 1.5倍\n          }\n\n          if (this.octaveMode !== 2) {\n            // 音名→音階番号変換(C1 -> 12, C4 -> 48, ..)\n            note = 12 * currentOctave + this.NOTE_TABLE[command];\n\n            // 調音記号の処理\n            if (RegExp.$2 === '+' || RegExp.$2 === '#') {\n              note++;\n            } else if (RegExp.$2 === '-') {\n              note--;\n            }\n          }\n        }\n\n        // オクターブ調整（楽器の音域エミュレーション。通常は0。GM互換モード時のみ使用）\n        switch (this.octaveMode) {\n          case 1:\n            // オクターブループモード\n            while (note < this.minNote) note = note + 12;\n            while (note > this.maxNote) note = note - 12;\n            note += 12;\n            break;\n          case 2:\n            // ワンショットモード（音階の強制指定）\n            note = this.maxNote;\n            break;\n          default:\n            // 通常モード（非GMモードでは常にこれ）\n            note += 12;\n            break;\n        }\n\n        if (!tieEnabled) {\n          // 前回タイ記号が無いときのみノートオン\n          events.push(\n            new ChannelEvent(\n              'NoteOn',\n              0,\n              time,\n              this.channel,\n              note,\n              currentVelocity * this.VELOCITY_MAGNIFICATION, // ※127÷15≒8.4なので8とする。\n            ),\n          );\n        } else if (note !== currentNote) {\n          // c&dなど無効なタイの処理\n          events.push(\n            new ChannelEvent('NoteOff', 0, time - this.noteOffNegativeOffset, this.channel, currentNote),\n          );\n          tieEnabled = false;\n        }\n\n        // タイムカウンタを音符の長さだけ進める\n        time += tick;\n\n        // ノートオフ命令の追加\n        if (RegExp.$5 === '&') {\n          // タイ記号の処理\n          tieEnabled = true;\n          currentNote = note; // 直前の音階を保存\n        } else {\n          tieEnabled = false;\n          // 発音と消音が同じ時間の場合、そこのノートが再生されないため、消音時にtimeを-1する。\n          events.push(\n            new ChannelEvent('NoteOff', 0, time - this.noteOffNegativeOffset, this.channel, note),\n          );\n        }\n      } else if (message.match(/R([0-9]*)(\\.?)/i)) {\n        // 休符設定 R[n][.] (n=1～64)\n        value = RegExp.$1 | 0;\n\n        if (value >= 1 && value <= this.MINIM) {\n          // L1 -> 128tick .. L64 -> 2tick\n          tick = Math.floor(this.SEMIBREVE / value);\n        }\n\n        if (RegExp.$2 === '.') {\n          // 付点つき -> 1.5倍\n          tick = Math.floor(tick * 1.5);\n        }\n\n        time += tick; // タイムカウンタを休符の長さだけ進める\n      } else {\n        console.warn('unknown signeture.', message);\n      }\n    }\n    // イベントを代入\n    this.events = events;\n    // 演奏完了時間を代入\n    this.endTime = time;\n  }\n}\n","// This file is auto-generated by the build system.\nconst Meta = {\n  version: '0.3.4',\n  date: '2019-12-27T08:47:34.579Z',\n};\nexport default Meta;\n","/**\n * Midi Event abstract Structure\n */\nclass Event {\n  /**\n   * @param {string} subtype event subtype name.\n   * @param {number} deltaTime delta time.\n   * @param {number} time time.\n   */\n  constructor(subtype, deltaTime, time) {\n    /** @type {string} */\n    this.subtype = subtype;\n    /** @type {number} */\n    this.deltaTime = deltaTime;\n    /** @type {number} */\n    this.time = time;\n  }\n}\n\n/**\n * Midi Channel Event Structure\n * @extends {Event}\n */\nclass ChannelEvent extends Event {\n  /**\n   * @param {string} subtype\n   * @param {number} deltaTime delta time.\n   * @param {number} time time.\n   * @param {number} channel\n   * @param {number=} optParameter1\n   * @param {number=} optParameter2\n   */\n  constructor(subtype, deltaTime, time, channel, optParameter1, optParameter2) {\n    super(subtype, deltaTime, time);\n    /** @type {number} */\n    this.channel = channel;\n    /** @type {(number|undefined)} */\n    this.parameter1 = optParameter1;\n    /** @type {(number|undefined)} */\n    this.parameter2 = optParameter2;\n  }\n}\n\n/**\n * System Exclusive Event Structure\n * @extends {Event}\n */\nclass SystemExclusiveEvent extends Event {\n  /**\n   * @param {string} subtype\n   * @param {number} deltaTime delta time.\n   * @param {number} time time.\n   * @param {ByteArray} data\n   */\n  constructor(subtype, deltaTime, time, data) {\n    super(subtype, deltaTime, time);\n    /** @type {ByteArray} */\n    this.data = data;\n  }\n}\n\n/**\n * Midi Meta Event Structure\n * @extends {Event}\n */\nclass MetaEvent extends Event {\n  /**\n   * @param {string} subtype\n   * @param {number} deltaTime delta time.\n   * @param {number} time time.\n   * @param {Array.<*>} data meta data.\n   */\n  constructor(subtype, deltaTime, time, data) {\n    super(subtype, deltaTime, time);\n    /** @type {Array.<*>} */\n    this.data = data;\n  };\n}\n\nexport {\n  ChannelEvent,\n  SystemExclusiveEvent,\n  MetaEvent,\n};\n","/**\n * Mld Parser Class\n */\nexport default class Mld {\n  /**\n   * @param {ByteArray} input\n   * @param {Object=} optParams\n   */\n  constructor(input, optParams = {}) {\n    /** @type {ByteArray} */\n    this.input = input;\n    /** @type {number} */\n    this.ip = optParams.index || 0;\n    /** @type {number} */\n    this.timeDivision = optParams.timeDivision || 48;\n    /** @type {Object} */\n    this.header;\n    /** @type {Object} */\n    this.dataInformation;\n    /** @type {Array.<Array.<Object>>} */\n    this.tracks;\n  };\n\n  /**\n   */\n  parse() {\n    this.parseHeader();\n    this.parseDataInformation();\n    this.parseTracks();\n  };\n\n  /**\n   */\n  parseHeader() {\n    /** @type {ByteArray} */\n    const input = this.input;\n    /** @type {number} */\n    let ip = this.ip;\n    /** @type {Object} */\n    const header = this.header = {};\n    /** @type {string} */\n    const signature =\n      String.fromCharCode(input[ip++], input[ip++], input[ip++], input[ip++]);\n\n    if (signature !== 'melo') {\n      throw new Error('invalid MFi signature:' + signature);\n    }\n\n    header.fileLength = (\n      (input[ip++] << 24) | (input[ip++] << 16) |\n      (input[ip++] << 8) | input[ip++]\n    ) >>> 0;\n\n    header.trackOffset = (\n      (input[ip++] << 16) | input[ip++]\n    ) + ip;\n\n    header.dataMajorType = input[ip++];\n    header.dataMinorType = input[ip++];\n    header.numberOfTracks = input[ip++];\n\n    this.ip = ip;\n  };\n\n  /**\n   */\n  parseDataInformation() {\n    /** @type {ByteArray} */\n    const input = this.input;\n    /** @type {number} */\n    let ip = this.ip;\n    /** @type {Object} */\n    const dataInformation = this.dataInformation = {\n      copy: null,\n      date: null,\n      exst: null,\n      note: null,\n      prot: null,\n      sorc: null,\n      titl: null,\n      trac: null,\n      vers: null,\n    };\n    /** @type {string} */\n    let type;\n    /** @type {number} */\n    let size;\n\n    while (ip < this.header.trackOffset) {\n      type =\n        String.fromCharCode(input[ip++], input[ip++], input[ip++], input[ip++]);\n      size = (input[ip++] << 8) | input[ip++];\n\n      switch (type) {\n        case 'titl':\n        /* FALLTHROUGH */\n        case 'copy':\n        /* FALLTHROUGH */\n        case 'vers':\n        /* FALLTHROUGH */\n        case 'date':\n        /* FALLTHROUGH */\n        case 'prot':\n          dataInformation[type] = String.fromCharCode.apply(\n            null,\n            input.subarray(ip, ip += size),\n          );\n          break;\n        case 'sorc':\n          dataInformation[type] = input[ip++];\n          break;\n        case 'note':\n          dataInformation[type] = (input[ip++] << 8) | input[ip++];\n          break;\n        case 'exst':\n          /* FALLTHROUGH */\n          break;\n        default:\n          dataInformation[type] = input.subarray(ip, ip += size);\n          break;\n      }\n    }\n\n    this.ip = ip;\n  }\n\n  /**\n   */\n  parseTracks() {\n    /** @type {ByteArray} */\n    const input = this.input;\n    /** @type {number} */\n    let ip = this.ip;\n    /** @type {string} */\n    let signature;\n    /** @type {number} */\n    let size;\n    /** @type {number} */\n    let limit;\n    /** @type {number} */\n    let status;\n    /** @type {number} */\n    let extendStatus;\n    /** @type {Object} */\n    let message;\n    /** @type {Array.<Array.<Object>>} */\n    const tracks = this.tracks = [];\n    /** @type {Array.<Object>} */\n    let track;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /**\n     * @return {Array.<Object>}\n     */\n    const parseEditInstrument = () => {\n      /** @type {number} */\n      const length = (input[ip++] << 8) | input[ip++];\n      /** @type {number} */\n      const limit = ip + length;\n      /** @type {Array.<Object>} */\n      const result = [];\n      /** @type {Object} */\n      let info;\n\n      // const\n      if (input[ip++] !== 1) {\n        throw new Error('invalid EditInstrument const value:' + input[ip - 1]);\n      }\n\n      while (ip < limit) {\n        info = {};\n\n        info.part = (input[ip++] >> 4) & 0x3;\n        info.modulator = {\n          ML: input[ip] >> 5,\n          VIV: (input[ip] >> 4) & 0x1,\n          EG: (input[ip] >> 3) & 0x1,\n          SUS: (input[ip] >> 2) & 0x1,\n          RR: ((input[ip++] & 0x3) << 2) | (input[ip] >> 6),\n          DR: (input[ip] >> 4) & 0xf,\n          AR: ((input[ip++] & 0x3) << 2) | (input[ip] >> 6),\n          SL: (input[ip] >> 4) & 0xf,\n          TL: ((input[ip++] & 0x3) << 4) | (input[ip] >> 4),\n          WF: (input[ip] >> 3) & 0x1,\n          FB: input[ip++] & 0x7,\n        };\n        info.carrier = {\n          ML: input[ip] >> 5,\n          VIV: (input[ip] >> 4) & 0x1,\n          EG: (input[ip] >> 3) & 0x1,\n          SUS: (input[ip] >> 2) & 0x1,\n          RR: ((input[ip++] & 0x3) << 2) | (input[ip] >> 6),\n          DR: (input[ip] >> 4) & 0xf,\n          AR: ((input[ip++] & 0x3) << 2) | (input[ip] >> 6),\n          SL: (input[ip] >> 4) & 0xf,\n          TL: ((input[ip++] & 0x3) << 4) | (input[ip] >> 4),\n          WF: (input[ip] >> 3) & 0x1,\n          FB: input[ip++] & 0x7,\n        };\n        info.octaveSelect = input[ip++] & 0x3;\n\n        result.push(info);\n      }\n\n      return result;\n    };\n    /**\n     * @return {{part: number, switch: number}}\n     */\n    const parseVibrato = () => {\n      // const\n      if (input[ip++] !== 1) {\n        throw new Error('invalid Vibrato const value:' + input[ip - 1]);\n      }\n\n      return {\n        part: (input[ip++] >> 5) & 0x3,\n        switch: (input[ip++] >> 6),\n      };\n    };\n    /**\n     * @return {{data: ByteArray}}\n     */\n    const parseDeviceSpecific = () => {\n      /** @type {number} */\n      const length = (input[ip++] << 8) | input[ip++];\n      /** @type {number} */\n      const limit = ip + length;\n\n      // const\n      if (input[ip++] !== 0x11) {\n        throw new Error('invalid DeviceSpecific const value:' + input[ip - 1]);\n      }\n\n      return {\n        data: input.subarray(ip, ip += limit - ip),\n      };\n    };\n\n    for (i = 0, il = this.header.numberOfTracks; i < il; ++i) {\n      signature =\n        String.fromCharCode(input[ip++], input[ip++], input[ip++], input[ip++]);\n\n      if (signature !== 'trac') {\n        throw new Error('invalid track signature:' + signature);\n      }\n\n      size =\n        (input[ip++] << 24) | (input[ip++] << 16) |\n        (input[ip++] << 8) | input[ip++];\n\n      limit = ip + size;\n\n      track = tracks[i] = [];\n\n      while (ip < limit) {\n        message = {\n          key: null,\n          length: null,\n          octaveShift: null,\n          subType: null,\n          type: null,\n          value: {},\n          velocity: null,\n          voice: null,\n        };\n\n        // delta time\n        message.deltaTime = deltaTime = input[ip++];\n\n        // status\n        status = input[ip++];\n        if (status !== 0xff) {\n          message.type = 'note';\n          message.subType = 'Note';\n          message.voice = status >> 6;\n          message.key = status & 0x3f;\n\n          // note length\n          noteLength = message.length = input[ip++];\n\n          // extend status\n          if (this.dataInformation.note === 1) {\n            extendStatus = input[ip++];\n            message.velocity = extendStatus >> 2;\n            message.octaveShift = extendStatus & 0x3;\n          }\n        } else {\n          message.type = 'meta';\n\n          // status\n          status = input[ip++];\n          switch (status >> 4) {\n            // system message\n            case 0xb:\n              switch (status & 0xf) {\n                case 0x0:\n                  message.subType = 'MasterVolume';\n                  message.value = input[ip++];\n                  break;\n                case 0xa:\n                  message.subType = 'DrumScale';\n                  message.value = {\n                    channel: (input[ip] >> 3) & 0x7,\n                    drum: input[ip++] & 0x1,\n                  };\n                  break;\n                default:\n                  throw new Error('unknown message type:' + status.toString(16));\n              }\n              break;\n            // tempo message\n            case 0xc:\n              message.subType = 'SetTempo';\n              message.value = {\n                timeBase: (status & 0x7) === 7\n                  ? NaN : Math.pow(2, status & 0x7) * ((status & 0x8) === 0 ? 6 : 15),\n                tempo: input[ip++],\n              };\n              break;\n            // control message\n            case 0xd:\n              switch (status & 0xf) {\n                case 0x0:\n                  message.subType = 'Point';\n                  message.value = input[ip++];\n                  break;\n                case 0xd:\n                  message.subType = 'Loop';\n                  message.value = {\n                    id: input[ip] >> 6,\n                    count: input[ip] >> 2 & 0xf,\n                    point: input[ip++] & 0x3,\n                  };\n                  break;\n                case 0xe:\n                  message.subType = 'Nop';\n                  message.value = input[ip++];\n                  break;\n                case 0xf:\n                  message.subType = 'EndOfTrack';\n                  message.value = input[ip++];\n                  break;\n                default:\n                  throw new Error('unkwnon message type:' + status.toString(16));\n              }\n              break;\n            // instrument\n            case 0xe:\n              switch (status & 0xf) {\n                case 0x0:\n                  message.subType = 'InstrumentLowPart';\n                  message.value = {\n                    part: input[ip] >> 6,\n                    instrument: input[ip++] & 0x3f,\n                  };\n                  break;\n                case 0x1:\n                  message.subType = 'InstrumentHighPart';\n                  message.value = {\n                    part: input[ip] >> 6,\n                    instrument: input[ip++] & 0x1,\n                  };\n                  break;\n                case 0x2:\n                  message.subType = 'Volume';\n                  message.value = {\n                    part: input[ip] >> 6,\n                    volume: input[ip++] & 0x3f,\n                  };\n                  break;\n                case 0x3:\n                  message.subType = 'Valance';\n                  message.value = {\n                    part: input[ip] >> 6,\n                    valance: input[ip++] & 0x3f,\n                  };\n                  break;\n                case 0x4:\n                  message.subType = 'PitchBend';\n                  message.value = {\n                    part: input[ip] >> 6,\n                    value: input[ip++] & 0x3f,\n                  };\n                  break;\n                case 0x5:\n                  message.subType = 'ChannelAssign';\n                  message.value = {\n                    part: input[ip] >> 6,\n                    channel: input[ip++] & 0x3f,\n                  };\n                  break;\n                case 0x6:\n                  message.subType = 'VolumeChange';\n                  message.value = {\n                    part: input[ip] >> 6,\n                    volume: (input[ip++] & 0x3f) << 26 >> 26,\n                  };\n                  break;\n                case 0x7:\n                  message.subType = 'PitchBendRange';\n                  message.value = {\n                    part: input[ip] >> 6,\n                    value: (input[ip++] & 0x3f),\n                  };\n                  break;\n\n                case 0x8:\n                /*\n                // TODO: 未遭遇\n                message.subType = 'MasterFineTuning';\n                message.value = {\n                  'part': input[ip] >> 6,\n                  'value': (input[ip++] & 0x3f)\n                };\n                break;\n                */\n                // TODO: あってるか自信ない\n                case 0x9:\n                  message.subType = 'MasterCoarseTuning';\n                  message.value = {\n                    part: input[ip] >> 6,\n                    value: (input[ip++] & 0x3f),\n                  };\n                  break;\n                case 0xA:\n                  message.subType = 'Modulation';\n                  message.value = {\n                    part: input[ip] >> 6,\n                    depth: (input[ip++] & 0x3f),\n                  };\n                  break;\n                default:\n                  throw new Error('unkwnon message type:' + status.toString(16));\n              }\n              break;\n            // extended information\n            case 0xf:\n              switch (status & 0xf) {\n                case 0x0:\n                  message.subType = 'EditInstrument';\n                  message.value = parseEditInstrument();\n                  break;\n                case 0x1:\n                  message.subType = 'Vibrato';\n                  message.value = parseVibrato();\n                  break;\n                case 0xf:\n                  message.subType = 'DeviceSpecific';\n                  message.value = parseDeviceSpecific();\n                  break;\n                default:\n                  throw new Error('unkwnon message type:' + status.toString(16));\n              }\n              break;\n            default:\n              throw new Error('unkwnon message type:' + status.toString(16));\n          }\n        }\n\n        track.push(message);\n      }\n      ip = limit;\n    }\n\n    this.ip = ip;\n  }\n\n  /**\n   * @return {Object}\n   */\n  convertToMidiTracks() {\n    /** @type {Object} */\n    const result = {\n      timeDivision: this.timeDivision,\n      trac: [],\n      tracks: [],\n      plainTracks: [],\n    };\n    /** @type {Array.<Array.<Object>>} */\n    const tracks = result.tracks;\n    /** @type {Array.<Array.<Array.<number>>>} */\n    const plainTracks = result.plainTracks;\n    /** @type {Array.<Array.<Object>>} */\n    const mfiTracks = this.tracks;\n    /** @type {Array.<Object>} */\n    let mfiTrack;\n    /** @type {Object} */\n    let mfiEvent;\n    /** @type {Object} */\n    let prevEvent;\n    /** @type {Array.<Object>} */\n    let tmpTrack;\n    /** @type {number} */\n    let time;\n    /** @type {number} */\n    let pos;\n    /** @type {number} */\n    let key;\n    /** @type {number} */\n    let tmp;\n    /** @type {string} */\n    let str;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {number} */\n    let j;\n    /** @type {number} */\n    let jl;\n    /** @type {Array.<number>} */\n    const channelTime = [];\n    /** @type {number} */\n    let channel;\n\n    for (i = 0; i < 16; ++i) {\n      plainTracks[i] = [];\n      channelTime[i] = 0;\n    }\n\n    // 変換しにくい形式を平坦化する\n    for (i = 0, il = mfiTracks.length; i < il; ++i) {\n      mfiTrack = mfiTracks[i];\n      tmpTrack = [];\n\n      // note の処理\n      for (time = pos = j = 0, jl = mfiTrack.length; j < jl; ++j) {\n        mfiEvent = mfiTrack[j];\n        time += mfiEvent.deltaTime;\n        mfiEvent.id = pos;\n        mfiEvent.time = time;\n\n        switch (mfiEvent.subType) {\n          case 'Nop':\n            break;\n          case 'Note':\n            tmpTrack[pos++] = mfiEvent;\n            // TODO: value: ... 形式になおす\n            tmpTrack[pos] = {\n              id: pos,\n              type: 'internal',\n              subType: 'NoteOff',\n              time: time + mfiEvent.length,\n              key: mfiEvent.key,\n              voice: mfiEvent.voice,\n              velocity: mfiEvent.velocity,\n              octaveShift: mfiEvent.octaveShift,\n            };\n            pos++;\n            break;\n          case 'InstrumentHighPart':\n            prevEvent = mfiEvent;\n            mfiEvent = mfiTrack[++j];\n            if (mfiEvent.subType !== 'InstrumentLowPart') {\n              throw new Error('broken instrument');\n            }\n            // TODO: value: ... 形式になおす\n            tmpTrack[pos] = {\n              id: pos,\n              type: 'internal',\n              subType: 'ProgramChange',\n              time: time,\n              part: mfiEvent.value.part,\n              instrument: (prevEvent.value.instrument << 6) | mfiEvent.value.instrument,\n            };\n            pos++;\n            break;\n          default:\n            tmpTrack[pos++] = mfiEvent;\n            break;\n        }\n      }\n      tmpTrack.sort((a, b) => {\n        return a.time > b.time ? 1 : a.time < b.time ? -1\n          : a.id > b.id ? 1 : a.id < b.id ? -1\n            : 0;\n      });\n\n      // MIDI トラックに作成\n      tracks[i] = [];\n      for (time = j = 0, jl = tmpTrack.length; j < jl; ++j) {\n        mfiEvent = tmpTrack[j];\n        time = mfiEvent.time;\n\n        switch (mfiEvent.subType) {\n          case 'Note':\n            // NoteOn: 9n kk vv\n            key = this.applyOctaveShift(mfiEvent.key + 45, mfiEvent.octaveShift);\n            channel = i * 4 + mfiEvent.voice;\n\n            // TODO: リズムトラックの時は Key が -10 されているような気がする\n            if (channel === 9) {\n              key -= 10;\n            }\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                0x90 | channel,\n                key,\n                mfiEvent.velocity * 2,\n              ),\n            );\n            break;\n          case 'NoteOff':\n            // NoteOff: 8n kk vv\n            key = this.applyOctaveShift(mfiEvent.key + 45, mfiEvent.octaveShift);\n            channel = i * 4 + mfiEvent.voice;\n\n            // TODO: リズムトラックの時は Key が -10 されているような気がする\n            if (channel === 9) {\n              key -= 10;\n            }\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                0x80 | channel,\n                key,\n                mfiEvent.velocity * 2,\n              ),\n            );\n            break;\n          case 'ProgramChange':\n            // Program Change: Cn pp\n            channel = i * 4 + mfiEvent.part;\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                0xC0 | channel,\n                mfiEvent.instrument,\n              ),\n            );\n            break;\n          case 'SetTempo':\n            // SetTempo: FF 51 03 tt tt tt\n            tmp = 2880000000 / (mfiEvent.value.tempo * mfiEvent.value.timeBase);\n            channel = 0; // SetTempo は必ず先頭のトラックに配置する\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                0xFF,\n                0x51,\n                0x03,\n                (tmp >> 16) & 0xff, (tmp >> 8) & 0xff, tmp & 0xff,\n              ),\n            );\n            break;\n          case 'Loop':\n            // Marker: FF 06 ll ss ss ss ...\n            tmp = mfiEvent.value.count;\n            str = 'LOOP_' +\n              (mfiEvent.value.point === 0 ? 'START' : 'END') +\n              '=ID:' + mfiEvent.value.id +\n              ',COUNT:' + (tmp === 0 ? -1 : tmp);\n            channel = 0;\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                [\n                  0xFF,\n                  0x06,\n                  str.length,\n                ],\n                str.split('').map((a) => {\n                  return a.charCodeAt(0);\n                }),\n              ),\n            );\n            break;\n          case 'MasterVolume':\n            // Master Volume: F0 7F ee 04 01 dl dm F7\n            tmp = mfiEvent.value;\n            channel = 0;\n\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                0xF0,\n                0x07, // length\n                0x7F, 0x7F, 0x04, 0x01, tmp, tmp, 0xF7,\n              ),\n            );\n            break;\n          case 'Modulation':\n            // CC#1 Modulation: Bn 01 dd\n            channel = i * 4 + mfiEvent.value.part;\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                0xB0 | channel,\n                0x01,\n                mfiEvent.value.depth * 2,\n              ),\n            );\n            break;\n          case 'Volume':\n            // CC#7 Volume: Bn 07 dd\n            channel = i * 4 + mfiEvent.value.part;\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                0xB0 | channel,\n                0x07,\n                mfiEvent.value.volume * 2,\n              ),\n            );\n            break;\n          case 'Valance':\n            // CC#10 Panpot: Bn 0A dd\n            channel = i * 4 + mfiEvent.value.part;\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                0xB0 | channel,\n                0x0A,\n                (mfiEvent.value.valance - 32) * 2 + 64,\n              ),\n            );\n            break;\n          case 'PitchBend':\n            // Pitch Bend: En dl dm\n            // TODO: LSB = MSB で良いか不明\n            channel = i * 4 + mfiEvent.value.part;\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                0xE0 | channel,\n                mfiEvent.value.value * 2,\n                mfiEvent.value.value * 2,\n              ),\n            );\n            break;\n          case 'PitchBendRange':\n            // Pitch Bend: CC#100=0 CC#101=0 CC#6\n            // Bn 64 00 Bn 65 00 Bn 06 vv\n            channel = i * 4 + mfiEvent.value.part;\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                0xB0 | channel,\n                0x64, 0x00,\n              ),\n              [\n                0x00,\n                0xB0 | channel,\n                0x65, 0x00,\n              ],\n              [\n                0x00,\n                0xB0 | channel,\n                0x06, mfiEvent.value.value * 2,\n              ],\n            );\n            break;\n          case 'MasterCoarseTuning':\n            // MasterCoarseTuning: CC#100=0 CC#101=2 CC#6\n            // Bn 64 01 Bn 65 02 Bn 06 vv\n            channel = i * 4 + mfiEvent.value.part;\n            plainTracks[channel].push(\n              this.deltaTimeToByteArray(time - channelTime[channel]).concat(\n                0xB0 | channel,\n                0x64, 0x00,\n              ),\n              [\n                0x00,\n                0xB0 | channel,\n                0x65, 0x02,\n              ],\n              [\n                0x00,\n                0xB0 | channel,\n                0x06, mfiEvent.value.value * 2,\n              ],\n            );\n            break;\n          default:\n            continue;\n        }\n\n        channelTime[channel] = mfiEvent.time;\n      }\n    }\n    return this.toSMF(plainTracks);\n  }\n\n  /**\n   * @param {number} key\n   * @param {number} octaveShift\n   * @return {number}\n   */\n  applyOctaveShift(key, octaveShift) {\n    /** @type {Array.<number>} */\n    const table = [0, 12, -24, -12];\n\n    if (table[octaveShift] !== void 0) {\n      return key + table[octaveShift];\n    }\n\n    throw new Error('invalid OctaveShift value:' + octaveShift);\n  }\n\n  /**\n   * @param {Array.<Array.<ByteArray>>} plainTracks\n   * @return {ByteArray}\n   */\n  toSMF(plainTracks) {\n    /** @type {number} @const */\n    const TimeDivision = 48;\n    /** @type {Array.<number>} */\n    let trackHeader;\n    /** @type {Array.<number>} */\n    let trackData;\n    /** @type {ByteArray} */\n    let result = [\n      0x4D, 0x54, 0x68, 0x64, // \"MThd\"\n      0x00, 0x00, 0x00, 0x06, // Size\n      0x00, 0x01, // Format\n      0x00, 0x10, // number of track\n      (TimeDivision >> 8) & 0xff, TimeDivision & 0xff, // Data\n    ];\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {number} */\n    let j;\n    /** @type {number} */\n    let jl;\n\n    /**\n     * @param {string} str\n     * @return {Array.<number>}\n     */\n    function stringToArray(str) {\n      /** @type {number} */\n      let i;\n      /** @type {number} */\n      const il = str.length;\n      /** @type {Array.<number>} */\n      const array = new Array(il);\n\n      for (i = 0; i < il; ++i) {\n        array[i] = str.charCodeAt(i);\n      }\n\n      return array;\n    }\n\n    if (this.dataInformation.copy !== void 0) {\n      /** @type {Array.<number>} */\n      let copy = stringToArray(this.dataInformation.copy);\n\n      il = copy.length;\n      copy = [0x00, 0xff, 0x02].concat(\n        this.deltaTimeToByteArray(il),\n        copy,\n      );\n      plainTracks[0].unshift(copy);\n    }\n\n    /*\n    if (this.dataInformation['titl'] !== void 0) {\n      let title = stringToArray(this.dataInformation['titl']);\n      il = title.length;\n      title = [0x00, 0xff, 0x03].concat(\n        this.deltaTimeToByteArray(il),\n        title\n      );\n      plainTracks[0].unshift(title);\n    }\n    */\n\n    for (i = 0, il = plainTracks.length; i < il; ++i) {\n      const track = plainTracks[i];\n      trackData = [];\n      for (j = 0, jl = track.length; j < jl; ++j) {\n        Array.prototype.push.apply(trackData, track[j]);\n      }\n\n      jl = trackData.length;\n      trackHeader = [\n        0x4D, 0x54, 0x72, 0x6B, // \"MTrk\"\n        (jl >> 24) & 0xff, (jl >> 16) & 0xff,\n        (jl >> 8) & 0xff, (jl) & 0xff,\n      ];\n      result = result.concat(trackHeader, trackData);\n    }\n\n    return new Uint8Array(result);\n  }\n\n  /**\n   * @param {number} deltaTime\n   * @return {Array.<number>}\n   */\n  deltaTimeToByteArray(deltaTime) {\n    /** @type {Array.<number>} */\n    const array = [];\n\n    while (deltaTime >= 0x80) {\n      array.unshift(deltaTime & 0x7f | (array.length === 0 ? 0 : 0x80));\n      deltaTime >>>= 7;\n    }\n    array.unshift(deltaTime | (array.length === 0 ? 0 : 0x80));\n\n    return array;\n  }\n}\n","import PSGConverter from './PSGConverter';\nimport MakiMabiSequence from './mms';\nimport { MetaEvent, ChannelEvent, SystemExclusiveEvent } from './midi_event';\n/**\n * @classdesc   MabiIcco MML File Parser\n *\n * @author      Logue <logue@hotmail.co.jp>\n * @copyright   2019 Masashi Yoshikawa <https://logue.dev/> All rights reserved.\n * @license     MIT\n */\nexport default class MabiIcco extends MakiMabiSequence {\n  /**\n   * @param {ByteArray} input\n   * @param {Object=} optParams\n   */\n  constructor(input, optParams = {}) {\n    super(input, optParams);\n    /** @type {array} 入力データ。行ごとに配列化 */\n    this.input = String.fromCharCode\n      .apply('', new Uint16Array(input))\n      .split(/\\r\\n|\\r|\\n/);\n    /** @type {Array.<Array.<Object>>} 全トラックの演奏情報 */\n    this.tracks = [];\n    /** @type {Array.<Array.<Uint8Array>>} WMLに送る生のMIDIイベント */\n    this.plainTracks = [];\n    /** @param {number} トラック数 */\n    this.numberOfTracks = 1;\n    /** @type {number} 分解能 */\n    this.timeDivision = optParams.timeDivision || 96;\n  }\n\n  /**\n   * パース処理\n   */\n  parse() {\n    this.parseHeader();\n    this.parseTracks();\n    this.toPlainTrack();\n  }\n\n  /**\n   * ヘッダーメタ情報をパース\n   */\n  parseHeader() {\n    /** @type {TextEncoder} */\n    this.encoder = new TextEncoder('utf-8');\n\n    /** @type {array} 各トラックごと複数存在する変数名 */\n    const multipleKeys = [\n      'mml-track',\n      'name',\n      'program',\n      'songProgram',\n      'panpot',\n    ];\n    const ret = {};\n    /** @type {number} トラック番号（ヘッダー情報があるので初期値は-1） */\n    let trackNo = -1;\n    ret.track = [];\n\n    for (let i = 0; i < this.input.length; i++) {\n      const line = this.input[i].trim();\n      if (i === 0) {\n        if (line !== '[mml-score]') {\n          throw new Error('Not MabiIcco File.');\n        }\n        continue;\n      }\n      const [key, value] = line.split('=');\n      if (multipleKeys.includes(key)) {\n        if (key === 'mml-track') {\n          trackNo++;\n          ret.track[trackNo] = {};\n          // 「-」が含まれる名前を変数名として使うと面倒なので・・・。\n          ret.track[trackNo].mml = value;\n        } else {\n          ret.track[trackNo][key] = key === 'name' ? value : value | 0;\n        }\n      } else {\n        ret[key] = value;\n      }\n    }\n    /** @param {string} タイトル */\n    this.title = ret.title;\n    /** @param {string} 著者情報 */\n    this.author = ret.author;\n    /** @param {array} グローバルテンポ情報（テンポ変更のTickとテンポ？） */\n    const mmiTempo = (ret.tempo !== '') ? ret.tempo.split('T') : [0, 120];\n    /** @param {number} 分解能 */\n    this.timeDivision = 96;\n    /** @param {number} テンポ */\n    this.tempo = mmiTempo[1] | 0;\n    /** @param {array} 拍子記号 */\n    const timeSig = ret.time.split('/');\n    /** @type {array}  */\n    const headerTrack = [];\n    // GM Reset\n    headerTrack.push(\n      new SystemExclusiveEvent('SystemExclusive', 0, 0, [\n        0x7e,\n        0x7f,\n        0x09,\n        0x01,\n      ]),\n    );\n    // 曲名と著者情報を付加\n    headerTrack.push(new MetaEvent('SequenceTrackName', 0, 0, [this.title]));\n    headerTrack.push(new MetaEvent('CopyrightNotice', 0, 0, [this.author]));\n    headerTrack.push(\n      new MetaEvent('TimeSignature', 0, 0, [\n        timeSig[0] | 0 || 4,\n        timeSig[1] | 0 || 4,\n        0,\n        0,\n      ]),\n    );\n    headerTrack.push(\n      new MetaEvent('SetTempo', 0, 0, [Math.floor(60000000 / this.tempo)]),\n    );\n    headerTrack.push(new MetaEvent('EndOfTrack', 0, 0));\n    this.tracks.push(headerTrack);\n\n    this.input = ret.track;\n    // console.log(this);\n  }\n\n  /**\n   * MML parse\n   */\n  parseTracks() {\n    /** @type {array} MIDIイベント */\n    let track = [];\n    /** @type {array} 終了時間比較用 */\n    const endTimes = [];\n\n    for (let ch = 0; ch < this.input.length; ch++) {\n      /** @type {array} 現在のチャンネルの情報 */\n      const current = this.input[ch];\n      if (!current.mml.match(/^(?:MML@)(.*)/gm)) {\n        continue;\n      }\n\n      /** @type {array} MMLの配列（簡易マッチ） */\n      const mmls = RegExp.$1.split(',');\n\n      // 楽器名\n      track.push(new MetaEvent('InsturumentName', 0, 48, [current.name]));\n      // プログラムチェンジ\n      track.push(new ChannelEvent('ProgramChange', 0, 96, ch, current.program));\n      if (current.songProgram !== -1) {\n        // コーラス用\n        track.push(\n          new ChannelEvent('ProgramChange', 0, 112, 15, current.songProgram),\n        );\n      }\n      // パン(CC:0x10)\n      track.push(\n        new ChannelEvent('ControlChange', 0, 154, ch, 10, current.panpot),\n      );\n\n      // MMLの各チャンネルの処理\n      for (let chord = 0; chord < current.mml.length; chord++) {\n        let currentCh = ch;\n        if (chord === 3 && current.songProgram !== -1) {\n          // ch 16はコーラス用\n          // TODO: 現在の実装では一人しかコーラスを反映させることができない。（男女のコーラスを同時に鳴らせない）\n          // 複数の奏者でコーラスが指定されていた場合、男性女性用関係なく一番うしろのコーラスで指定された音色でマージされる。\n          currentCh = 15;\n        }\n        if (mmls[chord] === void 0) {\n          continue;\n        }\n\n        /** @param {PSGConverter} */\n        const mml2Midi = new PSGConverter({\n          timeDivision: this.timeDivision,\n          channel: currentCh,\n          timeOffset: 386,\n          mml: mmls[chord],\n          igonoreTempo: currentCh === 1,\n        });\n        // トラックにマージ\n        track = track.concat(mml2Midi.events);\n        endTimes.push(mml2Midi.endTime);\n      }\n\n      // トラック終了\n      track.concat(new MetaEvent('EndOfTrack', 0, Math.max(endTimes)));\n      this.tracks.push(track);\n    }\n    this.numberOfTracks = this.tracks.length;\n  }\n}\n","import PSGConverter from './PSGConverter';\nimport Ini from 'ini';\nimport { MetaEvent, ChannelEvent, SystemExclusiveEvent } from './midi_event';\n/**\n * @classdesc   MakiMabi Sequence File Parser\n *\n * @author      Logue <logue@hotmail.co.jp>\n * @copyright   2019 Masashi Yoshikawa <https://logue.dev/> All rights reserved.\n * @license     MIT\n */\nexport default class MakiMabiSequence {\n  /**\n   * @param {ByteArray} input\n   * @param {Object=} optParams\n   */\n  constructor(input, optParams = {}) {\n    /** @type {string} */\n    const string = String.fromCharCode.apply('', new Uint16Array(input));\n    /** @type {Ini} MMSファイルをパースしたもの */\n    this.input = Ini.parse(string);\n    /** @type {Array.<Array.<Object>>} 全トラックの演奏情報 */\n    this.tracks = [];\n    /** @type {Array.<Array.<Uint8Array>>} WMLに送る生のMIDIイベント */\n    this.plainTracks = [];\n    /** @param {number} トラック数 */\n    this.numberOfTracks = 1;\n    /** @type {number} 分解能 */\n    this.timeDivision = optParams.timeDivision || 96;\n  }\n\n  /**\n   * パース処理\n   */\n  parse() {\n    this.parseHeader();\n    this.parseTracks();\n    this.toPlainTrack();\n  }\n  ;\n  /**\n   * ヘッダーメタ情報をパース\n   */\n  parseHeader() {\n    /** @type {TextEncoder} */\n    this.encoder = new TextEncoder('shift_jis');\n    /** @type {object} インフォメーション情報 */\n    const header = this.input.infomation; // informationじゃない\n    /** @type {string} タイトル */\n    this.title = header.title;\n    /** @type {string} 著者情報 */\n    this.type = header.auther; // authorじゃない。\n    /** @param {number} 解像度 */\n    this.timeDivision = header.timeBase | 0 || 96;\n    /** @type {array} まきまびしーくの楽器番号変換テーブル（MabiIccoのMMSFile.javaのテーブルを流用） */\n    this.mmsInstTable = [\n      0, 1, 2, 3, 4, 5, 6, 7, 8, 9,\n      10, 11, 12, 13, 14, 15, 16, 17, 65, 66,\n      67, 68, 69, 70, 71, 72, 73, 74, 75, 76,\n      18,\n    ];\n\n    // 曲名と著者情報を付加\n\n    /** @type {array}  */\n    const headerTrack = [];\n    // GM Reset\n    headerTrack.push(new SystemExclusiveEvent('SystemExclusive', 0, 0, [0x7e, 0x7f, 0x09, 0x01]));\n    headerTrack.push(new MetaEvent('SequenceTrackName', 0, 0, [this.title]));\n    headerTrack.push(new MetaEvent('CopyrightNotice', 0, 0, [this.author]));\n    headerTrack.push(new MetaEvent('TimeSignature', 0, 0, [header.rythmNum | 0 || 4, header.rythmBase | 0 || 4, 0, 0]));\n    headerTrack.push(new MetaEvent('EndOfTrack', 0, 0));\n    this.tracks.push(headerTrack);\n\n    // infomationおよびmms-fileを取り除く\n    delete this.input.infomation;\n    delete this.input['mms-file'];\n  }\n  ;\n  /**\n   * MML parse\n   */\n  parseTracks() {\n    const input = this.input;\n    /** @type {array} MIDIイベント */\n    let track = [];\n    /** @type {array} 終了時間比較用 */\n    const endTimes = [];\n    /** @type {number} チャンネル */\n    let ch = 0;\n\n    for (const part in input) {\n      if (input.hasOwnProperty(part)) {\n        /** @param {array} MMLの配列 */\n        const mmls = [input[part].ch0_mml, input[part].ch1_mml, input[part].ch2_mml];\n        /** @param {number} パンポット */\n        const panpot = Number(input[part].panpot) + 64;\n\n        // 楽器名\n        track.push(new MetaEvent('InsturumentName', 0, 48, [input[part].name]));\n        // プログラムチェンジ\n        track.push(new ChannelEvent('ProgramChange', 0, 96, ch, this.mmsInstTable[input[part].instrument] | 0));\n        // パン\n        track.push(new ChannelEvent('ControlChange', 0, 154, ch, 10, panpot));\n\n        // MMLの各チャンネルの処理\n        for (let chord = 0; chord < mmls.length; chord++) {\n          /** @param {PSGConverter} */\n          const mml2Midi = new PSGConverter({\n            timeDivision: this.timeDivision,\n            channel: ch,\n            timeOffset: 386,\n            mml: mmls[chord],\n          });\n          // トラックにマージ\n          track = track.concat(mml2Midi.events);\n          endTimes.push(mml2Midi.endTime);\n        }\n        ch++;\n        // トラック終了\n        track.concat(new MetaEvent('EndOfTrack', 0, Math.max(endTimes)));\n        this.tracks.push(track);\n      }\n    }\n    this.numberOfTracks = this.tracks.length;\n  }\n\n  /**\n   * WebMidiLink信号に変換\n   */\n  toPlainTrack() {\n    for (let i = 0; i < this.tracks.length; i++) {\n      /** @type {array} トラックのイベント */\n      let rawTrackEvents = [];\n\n      /** @type {array} 全イベント */\n      let rawEvents = [];\n\n      /** @type {array} */\n      const events = this.tracks[i];\n\n      for (let j = 0; j < events.length; j++) {\n        /** @type {Event} イベント */\n        const event = events[j];\n        /** @var {Uint8Array} WebMidiLink信号 */\n        let raw;\n\n        if (event instanceof ChannelEvent) {\n          switch (event.subtype) {\n            case 'NoteOn':\n              // console.log(event);\n              if ((event).parameter2 === 0) {\n                raw = new Uint8Array([0x80 | event.channel, event.parameter1, event.parameter2]);\n              } else {\n                raw = new Uint8Array([0x90 | event.channel, event.parameter1, event.parameter2]);\n              }\n              break;\n            case 'NoteOff':\n              raw = new Uint8Array([0x80 | event.channel, event.parameter1, event.parameter2]);\n              break;\n            case 'ControlChange':\n              raw = new Uint8Array([0xB0 | event.channel, event.parameter1, event.parameter2]);\n              break;\n            case 'ProgramChange':\n              raw = new Uint8Array([0xC0 | event.channel, event.parameter1]);\n              break;\n          }\n        } else if (event instanceof MetaEvent) {\n          // Metaイベントの内容は実際使われない。単なる配列の数合わせのためのプレースホルダ（音を鳴らすことには関係ない処理だから）\n          /** @type {Uint8Array} */\n          const data = this.encoder.encode(event.data);\n          switch (event.subtype) {\n            case 'TextEvent':\n              raw = new Uint8Array([0xFF, 0x01].concat(data));\n              break;\n            case 'SequenceTrackName':\n              raw = new Uint8Array([0xFF, 0x03].concat(data));\n              break;\n            case 'CopyrightNotice':\n              raw = new Uint8Array([0xFF, 0x02].concat(data));\n              break;\n            case 'InsturumentName':\n              raw = new Uint8Array([0xFF, 0x04].concat(data));\n              break;\n            case 'SetTempo':\n              raw = new Uint8Array([0xFF, 0x51].concat(data));\n              break;\n            case 'TimeSignature':\n              raw = new Uint8Array([0xFF, 0x58].concat(data));\n              break;\n            case 'EndOfTrack':\n              raw = new Uint8Array([0xFF, 0x2F]);\n              break;\n          }\n        } else if (event instanceof SystemExclusiveEvent) {\n          raw = new Uint8Array([0xF0, 0x05].concat(event.data));\n        }\n        rawEvents = rawEvents.concat(raw);\n      }\n      rawTrackEvents = rawTrackEvents.concat(rawEvents);\n\n      this.plainTracks[i] = rawTrackEvents;\n    }\n  }\n}\n","import PSGConverter from './PSGConverter';\nimport MakiMabiSequence from './mms';\nimport { MetaEvent } from './midi_event';\n/**\n * @classdesc   MapleStory2 Mml Parser\n *\n * @author      Logue <logue@hotmail.co.jp>\n * @copyright   2019 Masashi Yoshikawa <https://logue.dev/> All rights reserved.\n * @license     MIT\n */\nexport default class MapleStory2Mml extends MakiMabiSequence {\n  /**\n   * @param {ByteArray} input\n   * @param {Object=} optParams\n   */\n  constructor(input, optParams = {}) {\n    super(input, optParams);\n    /** @type {TextEncoder} */\n    this.encoder = new TextEncoder('utf-8');\n    /** @type {DOMParser} */\n    const parser = new DOMParser();\n    /** @type {Document} */\n    const doc = parser.parseFromString(String.fromCharCode.apply('', new Uint16Array(input)), 'text/xml');\n    /** @param {Element} */\n    this.input = doc.querySelectorAll('ms2 > *');\n    /** @type {Array.<Array.<Object>>} 全トラックの演奏情報 */\n    this.tracks = [];\n    /** @type {Array.<Array.<Uint8Array>>} WMLに送る生のMIDIイベント */\n    this.plainTracks = [];\n    /** @param {number} トラック数 */\n    this.numberOfTracks = 1;\n    /** @type {number} 解像度 */\n    this.timeDivision = optParams.timeDivision || 96;\n  }\n\n  /**\n   */\n  parse() {\n    // this.parseHeader();\n    // this.parseDataInformation();\n    this.parseTracks();\n\n    this.toPlainTrack();\n  };\n\n  /**\n   * MML parse\n   */\n  parseTracks() {\n    /** @type {array} MIDIイベント */\n    let track = [];\n    /** @type {array} 終了時間比較用 */\n    const endTimes = [];\n\n    for (let i = 0; i < this.input.length; i++) {\n      /** @param {PSGConverter} */\n      const mml2Midi = new PSGConverter({\n        timeDivision: this.timeDivision,\n        channel: 0,\n        mml: this.input[i].textContent.trim(),\n        ignoreTempo: false,\n      });\n      track = track.concat(mml2Midi.events);\n      endTimes.push(mml2Midi.endTime);\n    }\n\n    // トラック終了\n    track.concat(new MetaEvent('EndOfTrack', 0, Math.max(endTimes)));\n    this.tracks.push(track);\n  }\n}\n","import MabiIcco from './mmi';\nimport MakiMabiSequence from './mms';\nimport MapleStory2Mml from './ms2mml';\nimport Meta from './meta';\nimport Mld from './mld';\nimport SMF from './smf';\nimport ThreeMacroLanguageEditor from './3mle';\n/**\n * Midi Player Class\n */\nexport class Player {\n  /**\n   * @param {string} target WML attach dom\n   */\n  constructor(target = '#wml') {\n    /** @type {number} */\n    this.tempo = 500000; // default\n    /** @type {HTMLIFrameElement} */\n    this.webMidiLink;\n    /** @type {number} */\n    this.resume;\n    /** @type {boolean} */\n    this.pause = true;\n    /** @type {boolean} */\n    this.ready = false;\n    /** @type {number} */\n    this.position = 0;\n    /** @type {Array.<Object>} */\n    this.track = [];\n    /** @type {number} */\n    this.timer = 0;\n    /** @type {Object} TODO: 最低限のプロパティは記述する */\n    this.sequence = {};\n    /** @type {boolean} */\n    this.enableCC111Loop = false;\n    /** @type {boolean} */\n    this.enableFalcomLoop = false;\n    /** @type {boolean} */\n    this.enableMFiLoop = false;\n    /** @type {boolean} */\n    this.enableLoop = false;\n    /** @type {number} */\n    this.tempoRate = 1;\n    /** @type {number} */\n    this.masterVolume = 16383;\n    /** @type {?string} */\n    this.textEvent = '';\n    /** @type {?string} */\n    this.sequenceName = '';\n    /** @type {?string} */\n    this.copyright = '';\n    /** @type {?string} */\n    this.lyrics = '';\n    /** @type {HTMLIFrameElement|Worker} */\n    this.webMidiLink = null;\n    /** @type {number} */\n    this.length = 0;\n    /** @type {number} */\n    this.time = 0;\n    /** @type {number} */\n    this.timeTotal;\n    /** @type {number} */\n    this.loaded = 0;\n    /** @type {Window} */\n    this.window = window;\n    /** @type {Element} */\n    this.target = this.window.document.querySelector(target);\n\n    /** @type {number} */\n    this.version = Meta.version;\n    /** @type {string} */\n    this.build = Meta.build;\n  }\n\n  /**\n   * @param {boolean} enable\n   */\n  setCC111Loop(enable) {\n    this.enableCC111Loop = enable;\n  }\n\n  /**\n   * @param {boolean} enable\n   */\n  setFalcomLoop(enable) {\n    this.enableFalcomLoop = enable;\n  }\n\n  /**\n   * @param {boolean} enable\n   */\n  setMFiLoop(enable) {\n    this.enableMFiLoop = enable;\n  }\n\n  /**\n   * @param {boolean} enable\n   */\n  setLoop(enable) {\n    this.enableLoop = enable;\n  }\n\n  /**\n   */\n  stop() {\n    /** @type {number} */\n    let i;\n\n    this.pause = true;\n    this.resume = Date.now();\n\n    if (this.webMidiLink) {\n      for (i = 0; i < 16; ++i) {\n        this.webMidiLink.contentWindow.postMessage('midi,b' + i.toString(16) + ',78,0', '*');\n      }\n    }\n  }\n\n  /**\n   * @return {HTMLIframeElement}\n   */\n  getWebMidiLink() {\n    return this.webMidiLink;\n  }\n\n  /**\n   */\n  init() {\n    this.stop();\n    this.initSequence();\n    this.pause = true;\n    this.track = null;\n    this.resume = -1;\n    this.text = null;\n    this.sequence = null;\n    this.sequenceName = null;\n    this.copyright = null;\n    this.lyrics = null;\n    this.textEvent = null;\n    this.length = 0;\n    this.position = 0;\n    this.time = 0;\n    this.timeTotal = 0;\n\n    this.window.clearTimeout(this.timer);\n\n    /** @type {Player} */\n    const player = this;\n    if (this.ready) {\n      this.sendInitMessage();\n    } else {\n      this.window.addEventListener('message', (ev) => {\n        if (ev.data === 'link,ready') {\n          player.sendInitMessage();\n        }\n      }, false);\n    }\n  };\n\n  /**\n   */\n  initSequence() {\n    this.tempo = 500000;\n    this.position = 0;\n\n    this.sendInitMessage();\n    this.pause = false;\n  }\n\n  /**\n   */\n  play() {\n    /** @type {Player} */\n    const player = this;\n\n    if (!this.webMidiLink) {\n      throw new Error('WebMidiLink not found');\n    }\n\n    if (this.ready) {\n      if (this.track) {\n        this.length = this.track.length;\n        if (this.track instanceof Array && this.position >= this.length) {\n          this.position = 0;\n        }\n        this.playSequence();\n      } else {\n        console.warn('Midi file is not loaded.');\n      }\n    } else {\n      this.window.addEventListener('message', (ev) => {\n        if (ev.data === 'link,ready') {\n          player.ready = true;\n          player.webMidiLink.style.height = this.webMidiLink.contentWindow.document.body.scrollHeight + 'px';\n          player.playSequence();\n        }\n      }, false);\n    }\n  };\n\n  /**\n   */\n  ended() {\n    player.window.postMessage('endoftrack', '*');\n  }\n\n  /**\n   */\n  sendInitMessage() {\n    /** @type {Window} */\n    const win = this.webMidiLink.contentWindow;\n    /** @type {number} */\n    let i;\n\n    for (i = 0; i < 16; ++i) {\n      // all sound off\n      win.postMessage('midi,b' + i.toString(16) + ',128,0', '*');\n      // volume\n      win.postMessage('midi,b' + i.toString(16) + ',07,64', '*');\n      // panpot\n      win.postMessage('midi,b' + i.toString(16) + ',0a,40', '*');\n      // pitch bend\n      win.postMessage('midi,e' + i.toString(16) + ',00,40', '*');\n      // pitch bend range\n      win.postMessage('midi,b' + i.toString(16) + ',64,00', '*');\n      win.postMessage('midi,b' + i.toString(16) + ',65,00', '*');\n      win.postMessage('midi,b' + i.toString(16) + ',06,02', '*');\n      win.postMessage('midi,b' + i.toString(16) + ',26,00', '*');\n    }\n    this.sendGmReset();\n  };\n\n  /**\n   * @param {string|Worker} port WebMidiLink url.\n   */\n  setWebMidiLink(port = './wml.html') {\n    /** @type {Player} */\n    const player = this;\n\n    const process = (ev) => {\n      if (typeof ev.data === 'string') {\n        const msg = ev.data.split(',');\n\n        if (msg[0] === 'link') {\n          // console.log(ev.data);\n          if (msg[1] === 'ready') {\n            player.ready = true;\n            player.loaded = 100;\n            player.setMasterVolume(player.masterVolume);\n          } else if (msg[1] === 'progress') {\n            // console.log(msg[2]);\n            player.loaded = Math.round((msg[2] / msg[3]) * 10000);\n          }\n        }\n      }\n    };\n\n    if (typeof port === 'string') {\n      // Clear self\n      if (this.webMidiLink) {\n        this.webMidiLink.parentNode.removeChild(this.webMidiLink);\n      }\n\n      // Clear parent DOM\n      if (this.target.firstChild) {\n        this.target.removeChild(this.target.firstChild);\n      }\n\n      /** @type {HTMLIFrameElement} */\n      const iframe = this.webMidiLink =\n        /** @type {HTMLIFrameElement} */\n        (this.window.document.createElement('iframe'));\n      iframe.src = port;\n      iframe.className = 'wml';\n\n      this.target.appendChild(iframe);\n      this.window.addEventListener('message', process, false);\n\n      const resizeHeight = () => {\n        iframe.style.height = this.webMidiLink.contentWindow.document.body.scrollHeight + 'px';\n      };\n\n      this.window.addEventListener('load', resizeHeight, false);\n\n      let timer = 0;\n      this.window.addEventListener('resize', () => {\n        if (timer > 0) {\n          clearTimeout(timer);\n        }\n        timer = setTimeout(resizeHeight, 100);\n      }, false);\n    } else {\n      // Worker Mode\n      this.webMidiLink.addEventListener('message', process, false);\n    }\n  };\n\n  /**\n   * @param {number} volume\n   */\n  setMasterVolume(volume) {\n    this.masterVolume = volume;\n\n    if (this.webMidiLink) {\n      this.webMidiLink.contentWindow.postMessage(\n        'midi,f0,7f,7f,04,01,' + [\n          ('0' + ((volume) & 0x7f).toString(16)).substr(-2),\n          ('0' + ((volume >> 7) & 0x7f).toString(16)).substr(-2),\n          '7f',\n        ].join(','),\n        '*',\n      );\n    }\n  };\n\n  /**\n   * @param {number} tempo\n   */\n  setTempoRate(tempo) {\n    this.tempoRate = tempo;\n  };\n\n  /**\n   */\n  playSequence() {\n    /** @type {Player} */\n    const player = this;\n    /** @type {number} */\n    const timeDivision = this.sequence.timeDivision;\n    /** @type {Array.<Object>} */\n    const mergedTrack = this.track;\n    /** @type {Window} */\n    const webMidiLink = this.webMidiLink.contentWindow;\n    /** @type {number} */\n    let pos = this.position || 0;\n    /** @type {Array.<?{pos: number}>} */\n    const mark = [];\n\n    const update = () => {\n      /** @type {number} */\n      const time = mergedTrack[pos].time;\n      /** @type {number} */\n      const length = mergedTrack.length;\n      /** @type {Object} TODO */\n      let event;\n      /** @type {?Array.<string>} */\n      let match;\n      /** @type {*} */\n      let tmp;\n      /** @type {number} */\n      let procTime = Date.now();\n\n      if (player.pause) {\n        player.resume = Date.now() - player.resume;\n        return;\n      }\n\n      do {\n        event = mergedTrack[pos].event;\n\n        switch (event.subtype) {\n          case 'TextEvent': // 0x01\n            // 主に歌詞などが入っている。MIDI作成者によってはデバッグ情報やお遊びも・・・。\n            player.textEvent = event.data[0];\n            break;\n          case 'Lyrics': // 0x05\n            // カラオケデーターが入っている。Textとの違いは、どの位置で表示するかやページ送りなどの制御コードが含まれている。\n            // とはいっても、単なるテキストデータ。\n            // KAR形式とYAMAHA独自のXF形式というカラオケ専用の書式がある。\n            // カラオケのパーサーは本プログラムでは実装しない。\n            // KAR形式：https://www.mixagesoftware.com/en/midikit/help/HTML/karaoke_formats.html\n            // XF形式：https://jp.yamaha.com/files/download/other_assets/7/321757/xfspc.pdf\n            player.lyrics = event.data[0];\n            break;\n          case 'Maker': // 0x06\n            if (player.enableFalcomLoop) {\n              // A-B Loop (Ys Eternal 2 Loop)\n              switch (event.data[0]) {\n                case 'A':\n                  mark[0] = {\n                    pos: pos,\n                  };\n                  break;\n                case 'B':\n                  if (mark[0] && typeof mark[0].pos === 'number') {\n                    pos = mark[0].pos;\n                    player.timer = player.window.setTimeout(update, 0);\n                    player.position = pos;\n                    return;\n                  }\n                  break;\n              }\n            }\n\n            if (player.enableMFiLoop) {\n              // MFi Loop\n              match = event.data[0].match(/^LOOP_(START|END)=ID:(\\d+),COUNT:(-?\\d+)$/);\n              if (match) {\n                if (match[1] === 'START') {\n                  mark[match[2] | 0] = mark[match[2]] || {\n                    pos: pos,\n                    count: match[3] | 0,\n                  };\n                } else if (match[1] === 'END' && player.enableMFiLoop) {\n                  tmp = mark[match[2] | 0];\n                  if (tmp.count !== 0) { // loop jump\n                    if (tmp.count > 0) {\n                      tmp.count--;\n                    }\n                    pos = tmp.pos;\n                    player.timer = player.window.setTimeout(update, 0);\n                    player.position = pos;\n                    return;\n                  } else { // loop end\n                    mark[match[2] | 0] = null;\n                  }\n                }\n              }\n            }\n            break;\n          case 'SetTempo': // 0x51\n            player.tempo = event.data[0];\n            break;\n        }\n\n        // CC#111 Loop\n        if (event.subtype === 'ControlChange' && event.parameter1 === 111) {\n          mark[0] = {\n            pos: pos,\n          };\n        }\n\n        // send message\n        webMidiLink.postMessage(mergedTrack[pos++].webMidiLink, '*');\n      } while (pos < length && mergedTrack[pos].time === time);\n\n      if (pos < length) {\n        procTime = Date.now() - procTime;\n        player.timer = player.window.setTimeout(\n          update,\n          player.tempo / (1000 * timeDivision) * (mergedTrack[pos].time - time - procTime) * (1 / player.tempoRate),\n        );\n      } else {\n        // loop\n        player.ended();\n        player.pause = true;\n        if (player.enableCC111Loop && mark[0] && typeof mark[0].pos === 'number') {\n          pos = mark[0].pos;\n        } else if (player.enableLoop) {\n          player.initSequence();\n          player.playSequence();\n        }\n      }\n\n      player.position = pos;\n      player.time = time;\n    };\n\n    if (!this.pause) {\n      this.timer = player.window.setTimeout(\n        update,\n        this.tempo / 1000 * timeDivision * this.track[0].time,\n      );\n    } else {\n      // resume\n      this.timer = player.window.setTimeout(\n        update,\n        this.resume,\n      );\n      this.pause = false;\n      this.resume = -1;\n    }\n  };\n\n  /**\n   * @param {ArrayBuffer} buffer\n   */\n  loadMidiFile(buffer) {\n    /** @type {SMF} */\n    const parser = new SMF(buffer);\n\n    this.init();\n    parser.parse();\n\n    this.mergeMidiTracks(parser);\n  };\n\n  /**\n   * @param {ArrayBuffer} buffer\n   */\n  loadMldFile(buffer) {\n    /** @type {Mld} */\n    const parser = new Mld(buffer);\n\n    this.init();\n    parser.parse();\n\n    this.mergeMidiTracks(parser.convertToMidiTracks());\n  }\n\n  /**\n   * @param {ArrayBuffer} buffer\n   */\n  loadMs2MmlFile(buffer) {\n    /** @type {MapleStory2Mml} */\n    const parser = new MapleStory2Mml(buffer);\n\n    this.init();\n    parser.parse();\n\n    this.mergeMidiTracks(parser);\n  }\n\n  /**\n   * @param {ArrayBuffer} buffer\n   */\n  loadMakiMabiSequenceFile(buffer) {\n    /** @type {MakiMabiSequence} */\n    const parser = new MakiMabiSequence(buffer);\n\n    this.init();\n    parser.parse();\n\n    this.mergeMidiTracks(parser);\n  }\n\n  /**\n   * @param {ArrayBuffer} buffer\n   */\n  load3MleFile(buffer) {\n    /** @type {ThreeMacroLanguageEditor} */\n    const parser = new ThreeMacroLanguageEditor(buffer);\n\n    this.init();\n    parser.parse();\n\n    this.mergeMidiTracks(parser);\n  }\n\n  /**\n   * @param {ArrayBuffer} buffer\n   */\n  loadMabiIccoFile(buffer) {\n    /** @type {MabiIcco} */\n    const parser = new MabiIcco(buffer);\n\n    this.init();\n    parser.parse();\n\n    this.mergeMidiTracks(parser);\n  }\n\n  /**\n   * @param {Object} midi\n   */\n  mergeMidiTracks(midi) {\n    /** @type {Array.<Object>} */\n    const mergedTrack = this.track = [];\n    /** @type {Array.<Array.<Object>>} */\n    const tracks = midi.tracks;\n    /** @type {Array.<number>} */\n    const trackPosition = new Array(tracks.length);\n    /** @type {Array.<Array.<Array.<number>>>} */\n    const plainTracks = midi.plainTracks;\n    /** @type {Array.<Object>} */\n    let track;\n    /** @type {number} */\n    let i;\n    /** @type {number} */\n    let il;\n    /** @type {number} */\n    let j;\n    /** @type {number} */\n    let jl;\n\n    // initialize\n    for (i = 0, il = tracks.length; i < il; ++i) {\n      trackPosition[i] = 0;\n    }\n\n    // merge\n    for (i = 0, il = tracks.length; i < il; ++i) {\n      track = tracks[i];\n      for (j = 0, jl = track.length; j < jl; ++j) {\n        if (midi.formatType === 0 || i === 0) {\n          // 著作権情報と曲名を取得\n          // SMF1のときは先頭のトラックから情報を取得する。\n          if (track[j].subtype === 'SequenceTrackName') {\n            this.sequenceName = track[j].data[0];\n          } else if (track[j].subtype === 'CopyrightNotice') {\n            this.copyright = track[j].data[0];\n          }\n        }\n\n        mergedTrack.push({\n          track: i,\n          eventId: j,\n          time: track[j].time,\n          event: track[j],\n          webMidiLink: 'midi,' +\n            Array.prototype.map.call(\n              plainTracks[i][j],\n              (a) => {\n                return a.toString(16);\n              },\n            ).join(','),\n        });\n      }\n    }\n\n    // sort\n    mergedTrack.sort((a, b) => {\n      return a.time > b.time ? 1 : a.time < b.time ? -1\n        : a.track > b.track ? 1 : a.track < b.track ? -1\n          : a.eventId > b.eventId ? 1 : a.eventId < b.eventId ? -1\n            : 0;\n    });\n\n    // トータルの演奏時間\n    this.timeTotal = mergedTrack.slice(-1)[0].time;\n    this.sequence = midi;\n  };\n\n  /**\n   * @return {?string}\n   */\n  getSequenceName() {\n    return this.sequenceName;\n  };\n\n  /**\n   * @return {?string}\n   */\n  getCopyright() {\n    return this.copyright;\n  };\n\n  /**\n   * @return {?string}\n   */\n  getLyrics() {\n    return this.lyrics;\n  }\n\n  /**\n   * @return {?string}\n  */\n  getTextEvent() {\n    return this.textEvent;\n  }\n\n  /**\n   * @return {number}\n   */\n  getPosition() {\n    return this.position;\n  }\n\n  /**\n   * @param {number} pos\n   */\n  setPosition(pos) {\n    this.position = pos;\n  }\n\n  /**\n   * @return {number}\n   */\n  getLength() {\n    return this.length;\n  }\n\n  /**\n   */\n  sendGmReset() {\n    if (this.webMidiLink) {\n      // F0 7E 7F 09 01 F7\n      this.webMidiLink.contentWindow.postMessage('midi,F0,7E,7F,09,01,F7', '*');\n    }\n  }\n\n  /**\n   */\n  sendAllSoundOff() {\n    if (this.webMidiLink) {\n      this.webMidiLink.contentWindow.postMessage('midi,b0,78,0', '*');\n    }\n  }\n\n  /**\n   * TODO: ちゃんと動いていない\n   * @param {number} time\n   * @return {string}\n   */\n  getTime(time) {\n    const secs = (this.tempo / 6000000) * time;\n\n    const hours = Math.floor(secs / (60 * 60));\n\n    const divisorForMinutes = secs % (60 * 60);\n    const minutes = Math.floor(divisorForMinutes / 60);\n\n    const divisorForSeconds = divisorForMinutes % 60;\n    const seconds = Math.ceil(divisorForSeconds);\n\n    return hours + ':' + ('00' + minutes).slice(-2) + ':' + ('00' + seconds).slice(-2);\n  }\n}\n","/**\n * Riff Parser class\n */\nexport default class Riff {\n  /**\n   * @param {ByteArray} input input buffer.\n   * @param {Object=} optParams option parameters.\n   */\n  constructor(input, optParams = {}) {\n    /** @type {ByteArray} */\n    this.input = input;\n    /** @type {number} */\n    this.ip = optParams.index || 0;\n    /** @type {number} */\n    this.length = optParams.length || input.length - this.ip;\n    /** @type {Array.<RiffChunk>} */\n    this.chunkList;\n    /** @type {number} */\n    this.offset = this.ip;\n    /** @type {boolean} */\n    this.padding =\n      optParams.padding !== void 0 ? optParams.padding : true;\n    /** @type {boolean} */\n    this.bigEndian =\n      optParams.bigEndian !== void 0 ? optParams.bigEndian : false;\n  }\n\n  /**\n   */\n  parse() {\n    /** @type {number} */\n    const length = this.length + this.offset;\n\n    this.chunkList = [];\n\n    while (this.ip < length) {\n      this.parseChunk();\n    }\n  }\n\n  /**\n   */\n  parseChunk() {\n    /** @type {ByteArray} */\n    const input = this.input;\n    /** @type {number} */\n    let ip = this.ip;\n    /** @type {number} */\n    let size;\n\n    this.chunkList.push(new RiffChunk(\n      String.fromCharCode(input[ip++], input[ip++], input[ip++], input[ip++]),\n      (size = this.bigEndian\n        ? ((input[ip++] << 24) | (input[ip++] << 16) |\n          (input[ip++] << 8) | (input[ip++])) >>> 0\n        : ((input[ip++]) | (input[ip++] << 8) |\n          (input[ip++] << 16) | (input[ip++] << 24)) >>> 0\n      ),\n      ip,\n    ));\n\n    ip += size;\n\n    // padding\n    if (this.padding && ((ip - this.offset) & 1) === 1) {\n      ip++;\n    }\n\n    this.ip = ip;\n  }\n\n  /**\n   * @param {number} index chunk index.\n   * @return {?RiffChunk}\n   */\n  getChunk(index) {\n    /** @type {RiffChunk} */\n    const chunk = this.chunkList[index];\n\n    if (chunk === void 0) {\n      return null;\n    }\n\n    return chunk;\n  }\n\n  /**\n   * @return {number}\n   */\n  getNumberOfChunks() {\n    return this.chunkList.length;\n  }\n}\n\n/**\n * Riff Chunk Structure\n * @interface\n */\nclass RiffChunk {\n  /**\n   * @param {string} type\n   * @param {number} size\n   * @param {number} offset\n   */\n  constructor(type, size, offset) {\n    /** @type {string} */\n    this.type = type;\n    /** @type {number} */\n    this.size = size;\n    /** @type {number} */\n    this.offset = offset;\n  }\n}\n","import {\n  ChannelEvent,\n  SystemExclusiveEvent,\n  MetaEvent,\n} from './midi_event';\nimport Meta from './meta';\nimport Riff from './riff';\n\n/**\n * Standard Midi File Parser class\n */\nexport default class SMF {\n  /**\n   * @param {ByteArray} input input buffer.\n   * @param {Object=} optParams option parameters.\n   */\n  constructor(input, optParams = {}) {\n    optParams.padding = false;\n    optParams.bigEndian = true;\n\n    /** @type {ByteArray} */\n    this.input = input;\n    /** @type {number} */\n    this.ip = optParams.index || 0;\n    /** @type {number} */\n    this.chunkIndex = 0;\n    /**\n     * @type {Riff}\n     * @private\n     */\n    this.riffParser_ = new Riff(input, optParams);\n\n    // MIDI File Information\n\n    /** @type {number} */\n    this.formatType = 0;\n    /** @type {number} */\n    this.numberOfTracks = 0;\n    /** @type {number} */\n    this.timeDivision = 0;\n    /** @type {Array.<Array.<Midi.Event>>} */\n    this.tracks = [];\n    /** @type {Array.<Array.<ByteArray>>} */\n    this.plainTracks = [];\n\n    /** @type {number} */\n    this.version = Meta.version;\n    /** @type {string} */\n    this.build = Meta.build;\n  };\n\n  /**\n   */\n  parse() {\n    /** @type {number} */\n    let i = 0;\n    /** @type {number} */\n    let il = 0;\n\n    // parse riff chunks\n    this.riffParser_.parse();\n\n    // parse header chunk\n    this.parseHeaderChunk();\n\n    // parse track chunks\n    for (i = 0, il = this.numberOfTracks; i < il; ++i) {\n      this.parseTrackChunk();\n    }\n  };\n\n  /**\n   */\n  parseHeaderChunk() {\n    /** @type {?{type: string, size: number, offset: number}} */\n    const chunk = this.riffParser_.getChunk(this.chunkIndex++);\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n\n    if (!chunk || chunk.type !== 'MThd') {\n      throw new Error('invalid header signature');\n    }\n\n    this.formatType = (data[ip++] << 8) | data[ip++];\n    this.numberOfTracks = (data[ip++] << 8) | data[ip++];\n    this.timeDivision = (data[ip++] << 8) | data[ip++];\n  };\n\n  /**\n   */\n  parseTrackChunk() {\n    /** @type {?{type: string, size: number, offset: number}} */\n    const chunk = this.riffParser_.getChunk(this.chunkIndex++);\n    /** @type {ByteArray} */\n    const data = this.input;\n    /** @type {number} */\n    let ip = chunk.offset;\n    /** @type {number} */\n    let size = 0;\n    /** @type {number} */\n    let deltaTime = 0;\n    /** @type {number} */\n    let eventType = 0;\n    /** @type {number} */\n    let channel = 0;\n    /** @type {number} */\n    let prevEventType = -1;\n    /** @type {number} */\n    let prevChannel = -1;\n    /** @type {number} */\n    let tmp = 0;\n    /** @type {number} */\n    let totalTime = 0;\n    /** @type {number} */\n    let offset = 0;\n    /** @type {number} */\n    let length = 0;\n    /** @type {number} */\n    let status = 0;\n    /** @type {Event} */\n    let event;\n    /** @type {ByteArray} */\n    let plainBytes;\n\n    /** @return {number} */\n    const readNumber = () => {\n      /** @type {number} */\n      let result = 0;\n      /** @type {number} */\n      let tmp = 0;\n\n      do {\n        tmp = data[ip++];\n        result = (result << 7) | (tmp & 0x7f);\n      } while ((tmp & 0x80) !== 0);\n\n      return result;\n    };\n\n    if (!chunk || chunk.type !== 'MTrk') {\n      throw new Error('invalid header signature');\n    }\n\n    size = chunk.offset + chunk.size;\n    const eventQueue = [];\n    const plainQueue = [];\n\n    while (ip < size) {\n      // delta time\n      deltaTime = readNumber();\n      totalTime += deltaTime;\n\n      // offset\n      offset = ip;\n\n      // event type value, midi channel\n      status = data[ip++];\n      eventType = (status >> 4) & 0xf;\n      channel = status & 0xf;\n\n      // run status rule\n      if (eventType < 8) {\n        eventType = prevEventType;\n        channel = prevChannel;\n        status = (prevEventType << 4) | prevChannel;\n        ip--;\n        offset--;\n      } else {\n        prevEventType = eventType;\n        prevChannel = channel;\n      }\n\n      // TODO\n      const table = [, , , , , , , ,\n        'NoteOff', // 0x8\n        'NoteOn',\n        'NoteAftertouch',\n        'ControlChange',\n        'ProgramChange',\n        'ChannelAftertouch',\n        'PitchBend',\n      ];\n\n      switch (eventType) {\n        // channel events\n        case 0x8:\n        /* FALLTHROUGH */\n        case 0x9:\n        /* FALLTHROUGH */\n        case 0xA:\n        /* FALLTHROUGH */\n        case 0xB:\n        /* FALLTHROUGH */\n        case 0xD:\n        /* FALLTHROUGH */\n        case 0xE:\n          event = new ChannelEvent(\n            table[eventType], deltaTime, totalTime,\n            channel, data[ip++], data[ip++],\n          );\n          break;\n        case 0xC:\n          event = new ChannelEvent(\n            table[eventType], deltaTime, totalTime,\n            channel, data[ip++],\n          );\n          break;\n        // meta events, system exclusive event\n        case 0xF:\n          switch (channel) {\n            // SysEx event\n            case 0x0:\n              tmp = readNumber();\n              if (data[ip + tmp - 1] !== 0xf7) {\n                throw new Error('invalid SysEx event');\n              }\n              event = new SystemExclusiveEvent(\n                'SystemExclusive', deltaTime, totalTime,\n                data.subarray(ip, (ip += tmp) - 1),\n              );\n              break;\n            case 0x7:\n              tmp = readNumber();\n              event = new SystemExclusiveEvent(\n                'SystemExclusive(F7)', deltaTime, totalTime,\n                data.subarray(ip, (ip += tmp)),\n              );\n              break;\n            // meta event\n            case 0xF:\n              eventType = data[ip++];\n              tmp = readNumber();\n              switch (eventType) {\n                case 0x00: // sequence number\n                  event = new MetaEvent(\n                    'SequenceNumber', deltaTime, totalTime, [data[ip++], data[ip++]],\n                  );\n                  break;\n                case 0x01: // text event\n                  event = new MetaEvent(\n                    'TextEvent', deltaTime, totalTime, [String.fromCharCode.apply(null, data.subarray(ip, ip += tmp))],\n                  );\n                  break;\n                case 0x02: // copyright notice\n                  event = new MetaEvent(\n                    'CopyrightNotice', deltaTime, totalTime, [String.fromCharCode.apply(null, data.subarray(ip, ip += tmp))],\n                  );\n                  break;\n                case 0x03: // sequence/track name\n                  event = new MetaEvent(\n                    'SequenceTrackName', deltaTime, totalTime, [String.fromCharCode.apply(null, data.subarray(ip, ip += tmp))],\n                  );\n                  break;\n                case 0x04: // instrument name\n                  event = new MetaEvent(\n                    'InstrumentName', deltaTime, totalTime, [String.fromCharCode.apply(null, data.subarray(ip, ip += tmp))],\n                  );\n                  break;\n                case 0x05: // lyrics\n                  event = new MetaEvent(\n                    'Lyrics', deltaTime, totalTime, [String.fromCharCode.apply(null, data.subarray(ip, ip += tmp))],\n                  );\n                  break;\n                case 0x06: // marker\n                  event = new MetaEvent(\n                    'Marker', deltaTime, totalTime, [String.fromCharCode.apply(null, data.subarray(ip, ip += tmp))],\n                  );\n                  break;\n                case 0x07: // cue point\n                  event = new MetaEvent(\n                    'CuePoint', deltaTime, totalTime, [String.fromCharCode.apply(null, data.subarray(ip, ip += tmp))],\n                  );\n                  break;\n                case 0x20: // midi channel prefix\n                  event = new MetaEvent(\n                    'MidiChannelPrefix', deltaTime, totalTime, [data[ip++]],\n                  );\n                  break;\n                case 0x2f: // end of track\n                  event = new MetaEvent(\n                    'EndOfTrack', deltaTime, totalTime, [],\n                  );\n                  break;\n                case 0x51: // set tempo\n                  event = new MetaEvent(\n                    'SetTempo', deltaTime, totalTime, [(data[ip++] << 16) | (data[ip++] << 8) | data[ip++]],\n                  );\n                  break;\n                case 0x54: // smpte offset\n                  event = new MetaEvent(\n                    'SmpteOffset', deltaTime, totalTime, [data[ip++], data[ip++], data[ip++], data[ip++], data[ip++]],\n                  );\n                  break;\n                case 0x58: // time signature\n                  event = new MetaEvent(\n                    'TimeSignature', deltaTime, totalTime, [data[ip++], data[ip++], data[ip++], data[ip++]],\n                  );\n                  break;\n                case 0x59: // key signature\n                  event = new MetaEvent(\n                    'KeySignature', deltaTime, totalTime, [data[ip++], data[ip++]],\n                  );\n                  break;\n                case 0x7f: // sequencer specific\n                  event = new MetaEvent(\n                    'SequencerSpecific', deltaTime, totalTime, [data.subarray(ip, ip += tmp)],\n                  );\n                  break;\n                default: // unknown\n                  event = new MetaEvent(\n                    'Unknown', deltaTime, totalTime, [eventType, data.subarray(ip, ip += tmp)],\n                  );\n              }\n              break;\n            default:\n              console.warn('unknown message:', status.toString(16));\n          }\n          break;\n        // error\n        default:\n          throw new Error('invalid status');\n      }\n\n      // plain queue\n      length = ip - offset;\n      plainBytes = data.subarray(offset, offset + length);\n      plainBytes[0] = status;\n      if (\n        event instanceof ChannelEvent &&\n        event.subtype === 'NoteOn' &&\n        /** @type {ChannelEvent} */\n        (event).parameter2 === 0\n      ) {\n        event.subtype = table[8];\n        plainBytes = new Uint8Array([0x80 | event.channel, event.parameter1, event.parameter2]);\n      }\n      plainQueue.push(plainBytes);\n\n      // event queue\n      eventQueue.push(event);\n    }\n\n    this.tracks.push(eventQueue);\n    this.plainTracks.push(plainQueue);\n  };\n};\n"],"sourceRoot":""}